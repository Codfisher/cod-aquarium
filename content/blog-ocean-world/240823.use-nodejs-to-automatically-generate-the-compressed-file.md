---
title: æ‰“åŒ…å¾Œé †ä¾¿å£“ç¸®ä¸€ä¸‹å§ï¼Œä½¿ç”¨ Node.js è‡ªå‹•ç”¢ç”Ÿå£“ç¸®æª”
description: æœ‰äº›æ¡ˆå­éœ€è¦æ‰“åŒ…ã€å£“ç¸®å¾Œäº¤ä»˜ï¼Œé›–ç„¶å£“ç¸®æŒ‰ä¸€ä¸‹å¾ˆç°¡å–®ï¼Œä½†æ˜¯ä¸€ç›´é‡è¤‡å°±ä¸ç°¡å–®äº†ã€‚è®“æˆ‘å€‘ä½¿ç”¨è…³æœ¬è‡ªå‹•ç”¢ç”Ÿå£“ç¸®æª”ï¼Œä¸ç”¨å†æ‰‹å‹•å£“ç¸®äº†ã€‚â™ª(^âˆ‡^*)
tags: ['Node.js', 'JavaScript', 'TypeScript']
image: https://codlin.me/use-nodejs-to-automatically-generate-the-compressed-file.webp
date: 20240823
---

# æ‰“åŒ…å¾Œé †ä¾¿å£“ç¸®ä¸€ä¸‹å§ï¼Œä½¿ç”¨ Node.js è‡ªå‹•ç”¢ç”Ÿå£“ç¸®æª”

![use-nodejs-to-automatically-generate-the-compressed-file](/use-nodejs-to-automatically-generate-the-compressed-file.webp){height="600"}

æœ‰äº›æ¡ˆå­éœ€è¦æ‰“åŒ…ã€å£“ç¸®å¾Œäº¤ä»˜ï¼Œé›–ç„¶å£“ç¸®ä¹Ÿåªæ˜¯ç°¡å–®æŒ‰ä¸€ä¸‹ï¼Œä½†æ˜¯ä¸€ç›´é‡è¤‡å°±ä¸ç°¡å–®äº†ã€‚(Ë˜ï½¥_ï½¥Ë˜)

è®“æˆ‘å€‘ä½¿ç”¨è…³æœ¬è‡ªå‹•ç”¢ç”Ÿå£“ç¸®æª”ï¼Œè§£æ”¾æ‰‹å‹•å£“ç¸®è¼ªè¿´å§ã€‚â™ª(^âˆ‡^*)

## æª”æ¡ˆçµæ§‹

ç¬¬ä¸€æ­¥ç•¶ç„¶æ˜¯å…ˆä»‹ç´¹ä¸€ä¸‹æª”æ¡ˆçµæ§‹ã€‚

```text
.
â”œâ”€ dist              // æ‰“åŒ…å¾Œçš„æª”æ¡ˆ
â”œâ”€ scripts
â”‚   â””â”€ arch-dist.ts  // ç”¢ç”Ÿå£“ç¸®æª”çš„è…³æœ¬
â”œâ”€ package.json
â””â”€ ...
```

## å®‰è£å¥—ä»¶

æœå°‹äº†ä¸€ä¸‹ç™¼ç¾æœ‰å€‹å¥—ä»¶å«åš [archiver](https://www.npmjs.com/package/archiver)ï¼Œå¯ä»¥å¹«æˆ‘å€‘æ‰“åŒ…ã€å£“ç¸®æª”æ¡ˆã€‚

å®‰è£ archiverï¼š

```bash
npm i -D archiver @types/archiver
```

ä¾†å¯«ç¨‹å¼å§ï¼( â€¢Ì€ Ï‰ â€¢Ì )âœ§

`scripts\arch-dist.ts`

```ts
import { name } from '../package.json';

import fs from 'fs';
import archiver from 'archiver';

const fileName = `${name}.zip`;

const output = fs.createWriteStream(`./${fileName}`);
const archive = archiver('zip', {
  zlib: { level: 9 }
});

output.on('close', function () {
  console.log(`zip å£“ç¸®å®Œæˆ : `, fileName);
});

archive.on('error', function (err) {
  throw err;
});

/** å°‡è³‡æ–™å‚³è¼¸è‡³ output */
archive.pipe(output);
/** æŒ‡å®šè¦åŠ å…¥çš„ç›®éŒ„ï¼Œç¬¬äºŒåƒæ•¸ç‚º falseï¼Œè¡¨ç¤ºä¸è¦å°‡è‡ªå·±åŠ å…¥ */
archive.directory('./dist', false);
archive.finalize();
```

ç¨‹å¼ç¢¼å°±é€™éº¼ç°¡å–®ï¼Œéå¸¸çš„æ¨¸å¯¦ç„¡è¯ã€‚(Â´ãƒ»Ï‰ãƒ»`)

<br>

é±ˆé­šï¼šã€Œç¾åœ¨æˆ‘å€‘ä¾†åŸ·è¡Œè…³æœ¬å§ï¼ã€

è·¯äººï¼šã€ŒNode.js åˆä¸èƒ½ç›´æ¥è·‘ TypeScriptã€‚(âŠ™_âŠ™)ï¼Ÿã€

é±ˆé­šï¼šã€Œæ²’éŒ¯ï¼Œæ‰€ä»¥è®“æˆ‘å€‘ä¾†ç·¨è­¯å§ã€‚(â‰§âˆ‡â‰¦)ï¾‰ã€

è·¯äººï¼šï¼ˆç›´æ¥é›¢å ´ï¼‰

<br>

å…ˆåˆ¥èµ°å•Šï¼é–‹ç©ç¬‘çš„å•¦ï¼Œæˆ‘æ‰ä¸æœƒé€™æ¨£è‡ªæ‰¾éº»ç…©ã€‚(Â´,,â€¢Ï‰â€¢,,)

å¯ä»¥åˆ©ç”¨ vite-node ç›´æ¥åŸ·è¡Œ TypeScript è…³æœ¬ã€‚

vite-node å°±æ˜¯ Vitest èˆ‡ Nuxt 3 Dev SSR åº•å±¤ä½¿ç”¨çš„å·¥å…·ï¼Œå¯ä»¥è®“æˆ‘å€‘ç„¡ç—›åŸ·è¡Œ TypeScriptã€‚

ç”šéº¼ï¼Ÿä½ èªª ts-nodeï¼Ÿé‚£å€‹å¯¦åœ¨å¤ªé›£ç”¨ï¼Œæˆ‘å€‘é‚„æ˜¯ç”¨ vite-node å§ã€‚(Â´ãƒ»Ï‰ãƒ»`)

ç¾åœ¨è®“æˆ‘å€‘æ–°å¢è…³æœ¬ã€‚

`package.json`
  
```json
{
  "scripts": {
    "build": "vite build && npm run build:arch",
    "build:arch": "npx vite-node scripts/arch-dist.ts",
  },
}
```

::alert{type="primary"}
ä½¿ç”¨ npx å°±ä¸éœ€è¦å…ˆå®‰è£ vite-node äº†ï¼Œä¸çŸ¥é“çš„æœ‹å‹å¯ä»¥çœ‹çœ‹[é€™è£¡](https://hoyis-note.coderbridge.io/2021/07/20/npm-npx-%E5%B7%AE%E5%88%A5/)
::

é€™æ¨£å°±å¯ä»¥åœ¨ build å¾Œï¼Œè‡ªå‹•åŸ·è¡Œå£“ç¸®æª”æ¡ˆçš„è…³æœ¬äº†ã€‚

## ç¸½çµ ğŸŸ

- archiver å¥—ä»¶å¯ä»¥å¹«æˆ‘å€‘æ‰“åŒ…ã€å£“ç¸®æª”æ¡ˆ
- ä½¿ç”¨ vite-node å¯ä»¥ç„¡ç—›åŸ·è¡Œ TypeScript è…³æœ¬

çµ‚æ–¼ä¸ç”¨ä¸€ç›´æ‰‹å‹•å£“ç¸®æƒ¹ã€‚(ã€‚ãƒ»Ï‰ãƒ»ã€‚)
