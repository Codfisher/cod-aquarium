---
title: å‰å¾Œç«¯ä¸å†æ‰“æ¶ï¼Œè®“ ts-rest ç™¼æ® TypeScript çš„é­”æ³•å§ï¼ï¼ˆæ¦‚å¿µç¯‡ï¼‰
description: ts-rest å¯ä»¥å¯¦ç¾å¾ä¼ºæœå™¨åˆ°å®¢æˆ¶ç«¯çš„å…¨å‹åˆ¥å®‰å…¨ï¼Œå¯ä»¥æœ‰æ•ˆé™ä½å‰å¾Œç«¯æºé€šè¡€æµæˆæ²³çš„æ©Ÿç‡ã€‚(Â´,,â€¢Ï‰â€¢,,)
tags: ['Full Stack', 'TypeScript', 'ts-rest']
image: https://codlin.me/unleash-the-magic-of-type-script-with-ts-rest.webp
date: 20240628
---

![unleash-the-magic-of-type-script-with-ts-rest](/unleash-the-magic-of-type-script-with-ts-rest.webp){.cover}

# å‰å¾Œç«¯ä¸å†æ‰“æ¶ï¼Œè®“ ts-rest ç™¼æ® TypeScript çš„é­”æ³•å§ï¼ï¼ˆæ¦‚å¿µç¯‡ï¼‰

æœ¬æ–‡åŸºæ–¼ TypeScriptï¼Œå¦‚æœæ²’æœ‰æ¡ç”¨çš„å°å¤¥ä¼´å¯ä»¥ç‹ å¿ƒé›¢é–‹æƒ¹ã€‚~(>_<ã€‚)

æˆ–è€…ä¸€èµ·æ¹Šå€‹ç†±é¬§ã€‚(Â´â–½`Êƒâ™¡Æª)

æ­¤æ–‡ç‚ºæ¦‚å¿µç¯‡ï¼Œé¡§åæ€ç¾©å°±æ˜¯ä¾†èªè­˜èªè­˜ä½•è¬‚ ts-restã€‚

## ç”šéº¼æ˜¯ ts-restï¼Ÿ

ts-rest æ˜¯åŸºæ–¼ TypeScript çš„ RESTful API å·¥å…·ï¼Œä¸»è¦ç›®çš„åœ¨æ–¼å¯¦ç¾å¾ä»‹é¢å®šç¾©é–‹å§‹ï¼Œæ¶µè“‹è‡³ä¼ºæœå™¨ã€å®¢æˆ¶ç«¯çš„å…¨å‹åˆ¥å®‰å…¨ï¼Œè€Œä¸”ç„¡éœ€é¡å¤–ã€ç¹ç‘£çš„æ¨™è¨»æˆ–ç”Ÿæˆéç¨‹ã€‚

é¢¨æ ¼é¡ä¼¼ RPCï¼Œå¯ä»¥è®“ API å‘¼å«æ›´åŠ ç›´è¦ºï¼Œé…åˆ TSDoc æœ‰æ›´å®Œæ•´ã€è©³ç›¡çš„èªªæ˜ï¼Œå¯ä»¥å¤§å¹…é™ä½ä½¿ç”¨ API çš„å¿ƒæ™ºè² æ“”ã€‚

### å„ªé»

- å‰å¾Œç«¯æºé€šåŸºæ–¼ TypeScript åˆç´„ï¼Œæœ‰å®Œæ•´çš„å‹åˆ¥æç¤ºï¼Œå¯ä»¥é¿å…å¾ˆå¤šéŒ¯èª¤
- è³‡æ–™æ¬„ä½èˆ‡ç«¯é»æ›´æ˜ç¢ºï¼Œå¯ä»¥è®“ä½¿ç”¨è€…æ›´å®¹æ˜“ç†è§£ API åŠŸèƒ½
- é™ä½ç™¼å¸ƒã€è®Šæ›´å°è‡´ API éŒ¯èª¤çš„é¢¨éšª

### ç¼ºé»

- å­¸ç¿’æˆæœ¬è¼ƒé«˜
- éœ€è¦éµå®ˆä¸€å®šçš„è¦ç¯„
- å‰å¾Œç«¯éœ€è¦æœ‰è‰¯å¥½çš„æºé€šæ¨¡å¼æˆ–ç®¡é“

## å¾å‰æœ‰å€‹å¾Œç«¯å’Œå‰ç«¯

ä»¥ä¸‹ç¯„ä¾‹ä»¥ Vueã€NestJS ç‚ºä¾‹ï¼Œç›¸é—œå¥—ä»¶ç‰ˆæœ¬å¦‚ä¸‹ï¼š

- @nestjs/coreï¼š`10.4.1`
- @ts-rest/coreï¼š`3.51.0`
- @ts-rest/nestï¼š`3.51.0`
- zodï¼š`3.23.8`

ä»–å€‘æƒ³è¦åˆåŠ›ä¸²æ¥ä¸€å€‹è³‡æ–™ï¼Œå«åš CollectionDataã€‚

### é€šç”¨è³‡æ–™

å‰å¾Œç«¯æ‰‹ç‰½æ‰‹ï¼Œå…ˆè¨è«–æƒ³è¦çš„æ ¼å¼ã€‚(*â‰§ï¸¶â‰¦))(ï¿£â–½ï¿£* )ã‚

ç¬¬ä¸€æ­¥å®šç¾©å‚³è¼¸å±¤çš„ schemaï¼Œæ–¹å¼èˆ‡ zod ç›¸åŒã€‚

[å®šç¾© Zod Object](https://zod.dev/?id=objects)

```ts
import { z } from 'zod'

export const collectionDataSchema = z.object({
  id: z.string(),
  /** åç¨± */
  name: z.string(),
  description: z.string(),
  remark: z.string(),
})
export interface CollectionData extends z.infer<
  typeof collectionDataSchema
> { }

// ç”¨ type ä¹Ÿå¯ä»¥ï¼Œå–æ±ºæ–¼è²´åœ˜éšŠçš„è¦ç¯„
// export type CollectionData = z.infer<typeof collectionDataSchema>
```

æ¥è‘—æ ¹æ“šå‰›å‰›åˆ¶å®šçš„ schema å’Œ API åŠŸèƒ½å®šç¾©åˆç´„ï¼š

[ts-restï¼šDefine Contract](https://ts-rest.com/docs/core/)

```ts
import { AppRoute, initContract } from '@ts-rest/core'
import { z } from 'zod'
import { collectionDataSchema } from './schema'

// å»ºç«‹ collection-data
export const createCollectionDataDtoSchema = collectionDataSchema.omit({
  id: true,
  timestamp: true,
}).partial({
  remark: true,
  description: true,
})

/**
 * ä½¿ç”¨ satisfies æ˜¯ç‚ºäº† AppRoute çš„æ¬„ä½æç¤ºåˆå¯ä»¥ä¿ç•™å…·é«”å…§å®¹å®šç¾©ã€‚
 * ç•¶ç„¶ as const ä¹Ÿè¡Œï¼Œåªæ˜¯è¼¸å…¥çš„éç¨‹ä¸æœƒæœ‰ AppRoute æ¬„ä½æç¤ºã€‚
 * const create: AppRoute æœƒéºå¤±è©³ç´°çš„å…§å®¹å®šç¾©ï¼Œæ‰€ä»¥æœ€å¾Œæ¡ç”¨ satisfiesã€‚
 */
const create = {
  method: 'POST',
  path: '/v1/collection-data',
  body: createCollectionDataDtoSchema,
  responses: {
    201: collectionDataSchema,
  },
  summary: 'å»ºç«‹ collection-data',
} satisfies AppRoute

export const collectionDataContract = initContract().router({
  create,
}, {
  pathPrefix: '/api',
  commonResponses: {
    500: z.object({
      message: z.string(),
    }),
  },
})
```

è·¯äººï¼šã€Œæ€éº¼åªæœ‰ä¸€å€‹ createï¼Ÿà² _à² ã€

é±ˆé­šï¼šã€Œæˆ‘æ‡¶ã€‚(ãƒ„)ã€

è·¯äººï¼šï¼ˆæŠ½åˆ€ï¼‰

é±ˆé­šï¼šã€Œåˆ€ä¸‹ç•™é­šå•Š (ï¼ƒÂ°Ğ”Â°)ï¼Œæ˜¯å› ç‚ºå…§å®¹å¤ªå¤šæ€•å¤§å®¶æœƒç´¯å•¦ï¼Œç”¨å¿ƒè‰¯è‹¦æ¬¸ã€‚ã€

## å¾Œç«¯å¯¦ä½œï¼ˆNestJSï¼‰

ä¾ç…§å®˜ç¶²æ­¥é©Ÿå¯¦ä½œã€‚

[ts-restï¼šNest](https://ts-rest.com/docs/nest/)

ä»¥ä¸‹æ˜¯ä¸€å€‹ç°¡å–®çš„ç¯„ä¾‹ï¼š

```ts
// ...

@Controller()
export class CollectionDataController {
  constructor(
    private readonly loggerService: LoggerService,
    private readonly collectionDataService: CollectionDataService,
  ) { }

  @TsRestHandler(collectionDataContract.create, {
    validateResponses: true
  })
  async create() {
    return tsRestHandler(collectionDataContract.create, async ({
      body: dto,
    }) => {
      const [error, data] = await to(this.collectionDataService.create(dto))
      if (error) {
        this.loggerService.error(`å»ºç«‹ CollectionData éŒ¯èª¤ :`)
        this.loggerService.error(error)

        return {
          status: 500,
          body: {
            message: 'å»ºç«‹ CollectionData éŒ¯èª¤',
          },
        }
      }

      return {
        status: 201,
        body: data,
      }
    })
  }
}
```

::: tip
é‚£å€‹å¥‡æ€ªçš„ await to æ˜¯å› ç‚ºæˆ‘ç”¨äº†[é€™å€‹](./blog-program/await-to-js-keeps-your-promises-slick)ï¼Œä¸æ˜¯å¯«éŒ¯å–”ã€‚(ï½¡ï½¥âˆ€ï½¥)ï¾‰ï¾
:::

é–‹å•Ÿ validateResponses çš„è©±ï¼Œts-rest æœƒåš´æ ¼é©—è­‰ API éŸ¿æ‡‰è³‡æ–™æ ¼å¼æ˜¯å¦æ­£ç¢ºï¼ŒéŒ¯èª¤çš„è©±æœƒç›´æ¥å™´ 500ï¼Œé€™å°±è¡¨ç¤ºå¾Œç«¯æœ€å¥½åœ¨ e2e æ¸¬è©¦æ™‚ï¼Œå°±è©²æŠŠå¯èƒ½æƒ…å¢ƒæ¸¬å‡ºä¾†ï¼Œåªè¦æ¸¬è©¦æœ‰éï¼Œè³‡æ–™æ ¼å¼å°±ä¸å¯èƒ½éŒ¯ã€‚

å‰å¾Œç«¯å°±ä¸ç”¨å†ç‚ºäº†è³‡æ–™æœ‰å‘åµæ¶äº†ã€‚( â€§Ï‰â€§)ãƒâ•°(â€§Ï‰â€§ )

## å‰ç«¯å¯¦ä½œï¼ˆVueï¼‰

å‰ç«¯ç”¨æ³•æœ‰å…©ç¨®ï¼Œå¯ä»¥ä¾ç…§éœ€æ±‚æŒ‘é©åˆçš„ç”¨ï¼š

- [Fetch Client](https://ts-rest.com/docs/core/fetch)ï¼šç”¨æ³•å’Œ axiosã€fetch æ¦‚å¿µç›¸åŒã€‚
- [Vue Query](https://ts-rest.com/docs/vue-query)ï¼šå…¶å¯¦å°±æ˜¯ TanStack Query

å¯ä»¥æ¼¸é€²å¼å°å…¥ï¼Œå…©å€‹åŒæ™‚ç”¨ä¹Ÿæ²’å•é¡Œã€‚

å€‹äººæ¨è–¦ Vue Queryï¼Œé›–ç„¶æœ‰é»é–€æª»ï¼Œå¯æ˜¯åŠŸèƒ½å¾ˆå¼·å¾ˆå¥½ç”¨ã€‚(à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§

å¦‚æœéƒ½ä¸å–œæ­¡ï¼Œä¹Ÿå¯ä»¥[è‡ªå®šç¾©](https://ts-rest.com/docs/core/custom)ã€‚

### é©—è­‰

å‰ç«¯å¦‚æœå‘¼å« API å‰æƒ³å…ˆé©—è­‰ä¸€æ¬¡åƒæ•¸æ­£ç¢ºæ€§ã€‚ä¾‹å¦‚ï¼šé©—è­‰ collectionData API çš„ body è³‡æ–™æ˜¯å¦æ­£ç¢ºã€‚

åªè¦å–å¾— contract ä¸­å°æ‡‰è·¯å¾‘çš„ zod schema å³å¯ã€‚

```ts
const createCollectionDataDto = collectionDataContract.create.body

createCollectionDataDto.parse({
  // ...
})
```

å‰©ä¸‹å°±æ˜¯ zod çš„å·¥ä½œäº†ã€‚(oï¾Ÿvï¾Ÿ)ãƒ

[Zodï¼šparse](https://zod.dev/?id=parse)

### å‹åˆ¥

å‹åˆ¥å‰‡æ˜¯ä½¿ç”¨ ts-rest æä¾›çš„ [Inferring Types å·¥å…·](https://ts-rest.com/docs/core/infer-types)ã€‚

ä¾‹å¦‚å›æ‡‰å‹åˆ¥å¯ä»¥ä½¿ç”¨ `ServerInferResponseBody` æ¨å°ï¼š

```ts
type Data = ServerInferResponseBody<
  typeof collectionDataContract.create,
  201
>
```

![ServerInferResponseBody](/unleash-the-magic-of-type-script-with-ts-rest/ServerInferResponseBody.png)

ts-rest é‚„æœ‰å¾ˆå¤šå…§å®¹ï¼Œå¯ä»¥[ä¾†å®˜ç¶²é€›é€›](https://ts-rest.com/docs/intro)ã€‚â™ª(^âˆ‡^*)

## æ‰€ä»¥å‰å¾Œç«¯è¦æ€éº¼å…±äº«åˆç´„ï¼Ÿ

é±ˆé­šï¼šã€ŒçœŸæ˜¯å€‹å¥½å•é¡Œï¼Œç•¶ç„¶æ˜¯è¤‡è£½è²¼...á••( ï¾Ÿ âˆ€ã€‚)á•— ã€

è·¯äººï¼šï¼ˆæ‹¿èµ·çƒæ£’ï¼‰

é±ˆé­šï¼šã€Œé–‹ç©ç¬‘çš„å•¦ã€‚âˆ ( á› ã€âˆ )_ã€

ç›®å‰æˆ‘è‡ªå·±å·²çŸ¥ä¸éŒ¯çš„æ–¹å¼æœ‰ï¼š

- ç§æœ‰ npm
- monorepo

å€‹äººæ¯”è¼ƒæ¨è–¦ä½¿ç”¨ monorepoï¼Œæˆ‘å€‘å…¬å¸ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œè‡³æ–¼æ€éº¼ç”¨ Google æœ‰å¾ˆå¤šæ•™å­¸ï¼Œé€™è£¡å°±ä¸è´…è¿°å›‰ã€‚Ô…( Ë˜Ï‰Ë˜Ô…)

## ç¸½çµ ğŸŸ

- ts-rest å¯ä»¥è®“å‰å¾Œç«¯ä¸²æ¥æ›´åŠ åš´è¬¹ã€è‡ªå‹•åŒ–
- ä»‹ç´¹å¾Œç«¯ã€å‰ç«¯å¯¦ä½œ
- åˆç´„å¯ä»¥è—‰ç”±ç§æœ‰ npmã€monorepo å…±äº«

ä»¥ä¸Šæ­å–œä½ å®Œå…¨ç™¼æ® TypeScript çš„é­”æ³•æƒ¹ï¼Ë‹( Â° â–½ã€Â° )

å¾æ­¤å‰å¾Œç«¯å†ä¹Ÿä¸ç”¨ç‚ºè³‡æ–™ä¸ä¸€è‡´å•é¡Œæ‰“æ¶äº†ã€‚âœ§â‘ï½¡Ù©(ËŠá—œË‹*)Ùˆâœ§â•ï½¡

ç”šéº¼ï¼Ÿä½ èªªé‚„æœ‰å¾ˆå¤šäº‹æƒ…å¯ä»¥åµï¼Ÿâ•­(Â°A ,Â°`)â•®

é‚£å°±è¶…éæœ¬æ–‡çš„æ¢è¨ç¯„åœæƒ¹ï¼Œè¦æ‰“å»ç·´èˆå®¤æ‰“ã€‚á••( ï¾Ÿ âˆ€ã€‚)á•—
