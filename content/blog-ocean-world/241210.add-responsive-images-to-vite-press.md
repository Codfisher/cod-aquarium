---
title: VitePress ä½å€‹éŸ¿æ‡‰å¼åœ–ç‰‡å§
description: VitePress æ²’æœ‰ Nuxt Image é‚£æ¨£æ–¹ä¾¿ä¸”è‡ªå‹•çš„åœ–ç‰‡è™•ç†ï¼Œè©²æ€éº¼è¾¦å‘¢ï¼Ÿ
tags: ['VitePress']
image: https://codlin.me/add-responsive-images-to-vite-press.webp
date: 20241210
---

# VitePress ä½å€‹éŸ¿æ‡‰å¼åœ–ç‰‡å§

![add-responsive-images-to-vite-press](/add-responsive-images-to-vite-press.webp)

æ­¤éƒ¨è½æ ¼åŸæœ¬ä½¿ç”¨ Nuxt Content é–‹ç™¼ï¼Œä½†æ˜¯å› ç‚º Nuxt Content æŠŠæ–‡ç« ä¹Ÿç®—åœ¨ Server è³‡æºå…§ï¼Œå°è‡´è¶…é Cloudflare Workers å°ºå¯¸ä¸Šé™ã€‚

~~é ¹å»¢~~æ“±ç½®å¥½é•·ä¸€æ®µæ™‚é–“å¾Œï¼Œæœ€è¿‘çµ‚æ–¼æœ‰æ™‚é–“æ”¹ç”¨ VitePress é‡æ§‹äº†ã€‚

VitePress æ²’æœ‰ [Nuxt Image](https://image.nuxt.com) å¯ä»¥è‡ªå‹•è™•ç†[éŸ¿æ‡‰å¼åœ–ç‰‡](https://web.dev/articles/responsive-images)ï¼Œæ‰‹å‹•è™•ç†å¯¦åœ¨æ˜¯è¦é­šå‘½ã€‚<span class="text-nowrap">...(â€ºÂ´Ï‰`â€¹ )</span>

èº«ç‚ºä¸€å€‹ç¨±è·çš„ç¢¼è¾²ï¼Œç•¶ç„¶è¦è‡ªå‹•è™•ç†å•Šã€‚<span class="text-nowrap">â(ãƒ»Ï‰Â´ãƒ»â)</span>

çµæœ markdown-it æ‰¾ä¸åˆ°é©åˆçš„å¤–æ›ï¼Œåªå¥½è‡ªå·±æƒ³è¾¦æ³•äº†ã€‚<span class="text-nowrap">áƒš(ãƒ»Â´ï½ª`ãƒ»áƒš)</span>

å¦‚æœå¤§å¤§å€‘æœ‰æ›´å¥½çš„è§£æ³•ï¼Œ~~è«‹ä¸è¦å‘Šè¨´æˆ‘ï¼Œæˆ‘å·²ç¶“åšå®Œäº†~~ï¼Œèªªèªªçš„å•¦ï¼Œé‚„æ˜¯å‘Šè¨´æˆ‘å¥½äº†ã€‚<span class="text-nowrap">(*Â´âˆ€`)~â™¥</span>

::: tip
VitePress åŸºæ–¼ [markdown-it](https://vitepress.dev/guide/markdown#advanced-configuration) é€²è¡Œ Markdown è½‰æ›ï¼Œæ‰€ä»¥å¯ä»¥é€é markdown-it çš„å¤–æ›ä¾†æ“´å……åŠŸèƒ½ã€‚
:::

## é–‹ç™¼æ­¥é©Ÿ

æœå°‹ã€ç ”ç©¶äº†ä¸€ä¸‹ï¼Œç›®å‰ç¸½çµå‡ºä¾†çš„æ­¥é©Ÿç‚ºï¼š

1. é–‹ç™¼ä¸€å€‹ç”¢ç”ŸéŸ¿æ‡‰å¼åœ–ç‰‡çš„è…³æœ¬
1. åœ¨ [`buildEnd`](https://vitepress.dev/reference/site-config#buildend) éšæ®µåŸ·è¡Œè…³æœ¬
1. æ“´å±• markdown-itï¼Œå°‡ image æ¨™ç±¤æ›¿æ›ç‚ºè‡ªå®šç¾© Vue å…ƒä»¶ï¼ˆ`base-image`ï¼‰
1. é–‹ç™¼ `base-image` å…ƒä»¶ï¼Œç”¢ç”Ÿç´„å®šå¥½çš„åœ–ç‰‡å°ºå¯¸ä¹‹ srcset å±¬æ€§

æ–¹å‘æœ‰äº†ï¼Œç¾åœ¨ä¾†å¯¦ä½œå§ï¼<span class="text-nowrap">â—( â€¢Ï‰â€¢ )â—Ÿ</span>

### ç”¢ç”ŸéŸ¿æ‡‰å¼åœ–ç‰‡

é€™å€‹éƒ¨åˆ†å¾ˆå–®ç´”ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å–å¾—æ‰€æœ‰åœ–ç‰‡å¾Œï¼Œä½¿ç”¨ [sharp](https://www.npmjs.com/package/sharp) ç”¢ç”Ÿåœ–ç‰‡

<<< ../../.vitepress\scripts\resize-images.ts

### åŸ·è¡Œè…³æœ¬

ä¾ç…§ [VitePress æ–‡ä»¶](https://vitepress.dev/reference/site-config#build-hooks)èªªæ³•ï¼Œ`.vitepress\config.mts` ä¸­æœ‰å¤šå€‹ Build Hooks å¯ä»¥è¨­å®šã€‚

ç”±æ–¼æˆ‘å€‘åªè¦å»ºæ§‹å¾Œç”¢ç”Ÿï¼Œæ‰€ä»¥åœ¨ `buildEnd` éšæ®µåŸ·è¡Œå³å¯ã€‚

`.vitepress\config.mts`

```ts
import { generateImages } from './scripts/resize-images'

// https://vitepress.dev/reference/site-config
export default ({ mode }) => {
  return defineConfig({
    // ...
    async buildEnd() {
      await generateImages()
    },
  })
}
```

ç¾åœ¨è®“æˆ‘å€‘è©¦è©¦ build å¾Œæœƒä¸æœƒè·‘å‡ºå„ç¨®å°ºå¯¸çš„åœ–ç‰‡ã€‚<span class="text-nowrap">(Â´ãƒ»Ï‰ãƒ»`)</span>

åŸ·è¡Œ build å¾Œï¼Œæ²’æœ‰æ„å¤–çš„è©±ï¼Œæ‡‰è©²è¦å‡ºç¾ä»¥ä¸‹æ–‡å­—ã€‚

```shell
  vitepress v1.5.0

âœ“ building client + server bundles...
âœ“ rendering pages...
âœ“ generating sitemap...
[ generateImages ] æ‰¾åˆ° 43 å¼µåœ–ç‰‡
[ generateImages ] ç”¢ç”Ÿå®Œæˆ
build complete in 11.75s.
```

ä¸” dist è³‡æ–™å¤¾å…§æ‡‰è©²è¦è·‘å‡ºå„ç¨®å°ºå¯¸çš„åœ–ç‰‡ã€‚

![generate-rwd-image](/add-responsive-images-to-vite-press/generate-rwd-image.jpg)

åœ–ç‰‡å‡ºç¾äº†ï¼<span class="text-nowrap">â—(â‰§âˆ€â‰¦)â—Ÿ</span>

### æ“´å±• markdown-it

[`config.mts` ä¸­æœ‰ä¿ç•™æ¬„ä½](https://vitepress.dev/guide/markdown#advanced-configuration)ï¼Œå¯ä»¥è¨­å®šè‡ªè¡Œæ‹“å±• markdown-it åŠŸèƒ½ã€‚

æ–°å¢ä¸€å€‹ markdown-it å¤–æ›ï¼ŒåŠŸèƒ½å¾ˆå–®ç´”ï¼Œå°±æ˜¯å°‡ markdown ä¸­çš„ `img` æ¨™ç±¤æ›¿æ›ç‚º `base-image` å…ƒä»¶ã€‚

<<< ../../.vitepress\plugin\markdown-it-base-img.ts

### é–‹ç™¼ `base-image` å…ƒä»¶

æœ€å¾Œä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥ï¼Œé–‹ç™¼ `base-image` å…ƒä»¶ä¸¦ç”¢ç”Ÿ srcsetã€‚

<<< ../../components\base-img.vue

æ¥è‘—å°‡ `base-image` è¨»å†Šç‚ºå…¨åŸŸå…ƒä»¶ã€‚

`.vitepress\theme\index.ts`

```ts
import type { Theme } from 'vitepress'
// https://vitepress.dev/guide/custom-theme
import BaseImg from '../../components/base-img.vue'

export default {
  // ...
  enhanceApp({ app, router, siteData }) {
    app.component('BaseImg', BaseImg)
  },
} satisfies Theme
```

## ç¸½çµ ğŸŸ

ä»¥ä¸Šæˆ‘å€‘å®Œæˆè‡ªå‹•ç”¢ç”Ÿã€æ›¿æ›éŸ¿æ‡‰å¼åœ–ç‰‡çš„åŠŸèƒ½äº†ï¼

å…¶å¯¦é‚„æœ‰å¾ˆå¤šç´°ç¯€å¯ä»¥è™•ç†ï¼Œä¾‹å¦‚ï¼šå¦‚æœåœ–ç‰‡å°æ–¼ç›®æ¨™å°ºå¯¸ï¼Œå°±ä¸éœ€è¦ç”¢ç”Ÿæ–°åœ–ç‰‡ç­‰ç­‰ã€‚

æˆ‘å°±ä¸å‰å¥ªå…¶ä»–äººå¯¦é©—çš„æ©Ÿæœƒäº†ï¼Œæœ‰èˆˆè¶£çš„å¤§å¤§å€‘å¯ä»¥è‡ªå·±è©¦è©¦çœ‹ã€‚
