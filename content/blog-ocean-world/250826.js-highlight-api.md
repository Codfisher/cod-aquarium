---
description: åœ¨ JavaScript å¯¦ä½œç¶²é æ–‡å­—æœå°‹é—œéµå­—çš„ highlight æ•ˆæœ
tags: ['Vue', 'JavaScript']
image: https://codlin.me/js-highlight-api.webp
date: 20250826
---

<script setup>
  import HighlightInput from './js-highlight-api/highlight-input.vue'
  import FilterTable from './js-highlight-api/filter-table.vue'
  import TextHighlight from './js-highlight-api/text-highlight.vue'
  import HighlightTable from './js-highlight-api/highlight-table.vue'
  import HighlightColor from './js-highlight-api/highlight-color.vue'
</script>

![js-highlight-api](/js-highlight-api.webp){.cover}

# è¶Šæš—çš„åœ°æ–¹ä½ è¶Šäº®ï¼Œé€é JS æ¨™è¨˜é—œéµå­—å§

è£½ä½œé—œéµå­—ç¯©é¸çš„åŠŸèƒ½å¸¸å¸¸åœ¨æƒ³ï¼Œå¦‚æœèƒ½åƒç€è¦½å™¨å…§å»ºçš„é—œéµå­—æœå°‹åŠŸèƒ½é‚£æ¨£ï¼Œæ¨™è¨˜ç¬¦åˆçš„é—œéµå­—ï¼Œä½¿ç”¨é«”é©—æ‡‰è©²æœƒæ›´å¥½ã€‚

ç ”ç©¶äº†ä¸€è¼ªï¼Œç™¼ç¾é‚„çœŸçš„å¯ä»¥åšåˆ°ï¼Œè®“æˆ‘å€‘ä¸€æ­¥ä¸€æ­¥ä¾†å¯¦ä½œçœ‹çœ‹å§ï¼

ä¸çŸ¥é“ç”šéº¼æ˜¯æ–‡å­—æ¨™è¨˜æ•ˆæœï¼Ÿè©¦è©¦çœ‹ä¸‹æ–¹çš„è¼¸å…¥æ¡†å§ã€‚%( Â´ â–½ ` )ï¾‰%

<highlight-input />

## é—œéµå­—éæ¿¾

é¦–å…ˆè®“æˆ‘å€‘åšä¸€å€‹åŸºæœ¬çš„ table å…ƒä»¶ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥è¼¸å…¥é—œéµå­—ä¾†ç¯©é¸è³‡æ–™ã€‚

<filter-table />

å¯ä»¥çœ‹åˆ°ç•¶æˆ‘å€‘è¼¸å…¥é—œéµå­—æ™‚ï¼Œtable æœƒè‡ªå‹•ç¯©é¸å‡ºç¬¦åˆçš„è³‡æ–™ã€‚

å¦‚æœèƒ½å¤ å†æ¨™è¨˜ç¬¦åˆçš„é—œéµå­—ï¼Œå¯ä»¥å¤§å¹…æå‡ä½¿ç”¨é«”é©—ã€‚%( â€¢Ì€ Ï‰ â€¢Ì )âœ§%

æ‰€ä»¥æ‡‰è©²æ€éº¼åšå‘¢ï¼Ÿå°‡é—œéµå­—ä½¿ç”¨ `<mark>` æ¨™ç±¤åŒ…èµ·ä¾†å—ï¼Ÿ

é€™çš„ç¢ºæ˜¯æœ€ç¶“å…¸çš„åšæ³•ï¼Œä½†ç¾åœ¨æœ‰æ›´å®¹æ˜“çš„æ–¹æ³•äº†ï¼%( â€§Ï‰â€§)ãƒâ•°(â€§Ï‰â€§ )%

## Highlight API

ç¾åœ¨å¯ä»¥ä½¿ç”¨ [Highlight API](https://developer.mozilla.org/en-US/docs/Web/API/Highlight) å¯¦ç¾ï¼%â”€=â‰¡Î£((( ã¤â€¢Ì€Ï‰â€¢Ì)ã¤%

ä¸éç›®å‰ï¼ˆ2025/08/26ï¼‰æ”¯æ´åº¦ç‚ºã€ŒBaseline 2025 Newly availableã€ï¼Œå¦‚æœæœ‰èˆŠç€è¦½å™¨éœ€æ±‚ï¼Œå°±åªèƒ½ä¹–ä¹–å›å»ç”¨ `<mark>` æ¨™ç±¤äº†ã€‚%( Ë˜ï½¥Ğ·ï½¥)%

æ‰€ä»¥è©²æ€éº¼ä½¿ç”¨å‘¢ï¼Ÿæ¦‚å¿µç‚ºï¼š

1. å–å¾—è¦æ¨™è¨˜çš„æ–‡å­—ç›®æ¨™ DOM
1. ä½¿ç”¨ `Range` è¨­å®šæ¨™è¨˜ç¯„åœ
1. ä½¿ç”¨é€™å€‹ `Range` å»ºç«‹ä¸€å€‹ `Highlight` ç‰©ä»¶ã€‚
1. å°‡é€™å€‹ `Highlight` ç‰©ä»¶é€é CSS.highlights.set è¨»å†Šåˆ°ç€è¦½å™¨ï¼Œä¸¦æŒ‡å®šåç¨±ç‚º `'my-custom-highlight'`ã€‚
1. è¨­å®š `::highlight(my-custom-highlight)` æ¨£å¼å…§å®¹

ä»¥ä¸‹æ˜¯ç¯„ä¾‹ç¨‹å¼ï¼š

`content\blog-ocean-world\js-highlight-api\text-highlight.vue`

<<< ./js-highlight-api/text-highlight.vue

å¯¦éš›æ•ˆæœå¦‚ä¸‹ï¼š

<text-highlight />

å¯ä»¥æ³¨æ„åˆ°æ–‡å­—ä¸éœ€è¦è¢« `<mark>` åŒ…èµ·ä¾†ï¼ŒHighlight API æœƒè‡ªå‹•å¹«æˆ‘å€‘æ¨™è¨˜ç¬¦åˆçš„é—œéµå­—ã€‚

é€™æ¨£å°±ä¸ç”¨èª¿æ•´ HTML çµæ§‹äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿å•Šï¼%âˆ ( á› ã€âˆ )_%

## ä¾†å€‹å°è£

çŸ¥é“æ€éº¼ç”¨äº†ï¼Œç¾åœ¨è®“æˆ‘å€‘æŠŠé€™å€‹åŠŸèƒ½å°è£æˆ `useTextHighlight`ï¼Œè®“ä½¿ç”¨æ›´ç°¡å–®ã€æ–¹ä¾¿ã€‚

### éœ€æ±‚èˆ‡è¦æ ¼

ç¬¬ä¸€æ­¥ç•¶ç„¶æ˜¯ä¾†å€‹éœ€æ±‚åˆ†æï¼š

1. ç”¢ç”Ÿå”¯ä¸€åç¨±é¿å…äº’ç›¸å½±éŸ¿ï¼Œä¸¦æ³¨å…¥å°æ‡‰çš„ CSSï¼š

    ```css
    ::highlight(highlight-xxxxx) {
      background-color: yellow;
      color: black;
    }
    ```

1. é—œéµå­—æˆ– DOM æœ‰è®Šå‹•æ™‚ï¼š
    1. èµ°è¨ªå®¹å™¨è£¡çš„æ‰€æœ‰æ–‡å­—ç¯€é»
    1. æ‰¾å‡ºæ¯å€‹æ–‡å­—ç¯€é»ä¸­ã€Œé—œéµå­—ã€çš„æ‰€æœ‰å‡ºç¾ä½ç½®ã€‚
    1. å°æ¯å€‹å‘½ä¸­çš„ç‰‡æ®µå»ºç«‹ `Range`ï¼ŒåŠ åˆ° `Highlight` è£¡ã€‚
    1. æœ€å¾Œä½¿ç”¨ `CSS.highlights.set` å°‡ `Highlight` è¨»å†Šåˆ°ç€è¦½å™¨

1. åŠŸèƒ½ï¼ˆå…ƒä»¶ï¼‰ç§»é™¤æ™‚è‡ªå‹•ç§»é™¤æ¨™è¨˜èˆ‡æ¨£å¼

### å®šç¾©åƒæ•¸

```ts
interface UseTextHighlightOptions {
  /** æœå°‹ç›®æ¨™ï¼Œæœƒæ¨™è¨˜ä»¥ä¸‹æ–‡å­—ç¯€é» */
  target?: MaybeElementRef;
  /** æ¨™è¨˜åº•è‰² */
  background?: MaybeRefOrGetter<string>;
  /** æ¨™è¨˜æ–‡å­—é¡è‰² */
  color?: MaybeRefOrGetter<string>;
  /** é¡å¤–çš„è§¸ç™¼æ¢ä»¶ï¼Œè®Šå‹•æ™‚æœƒæ›´æ–°æ¨™è¨˜
   *
   * å¯ç¢ºä¿å¤–éƒ¨ä¾è³´è³‡æ–™æ›´æ–°å¾Œä¹Ÿæœƒæ›´æ–°æ¨™è¨˜
   */
  triggerOn?: MaybeRefOrGetter;
  /** å¼·åˆ¶å»¶é²æŒ‡å®šæ™‚é–“å¾Œå†åŸ·è¡Œ
   *
   * è‹¥ target DOM æ›´æ–°è‡ªå‹•åµæ¸¬ç„¡æ•ˆï¼Œå¯ä»¥ä½¿ç”¨æ­¤åƒæ•¸
   */
  delay?: number;
}
export function useTextHighlight(
  text: MaybeRefOrGetter<string>,
  options: UseTextHighlightOptions = {},
) {}
```

### ç›®æ¨™å…ƒç´ èˆ‡æ¨£å¼

æ¥è‘—å–å¾—ç›®æ¨™å…ƒç´ ä¸¦ç”¢ç”Ÿå”¯ä¸€åç¨±èˆ‡æ¨£å¼ï¼š

```ts
const highlightName = `highlight-${Math.random().toString(36).slice(2)}`

const targetEl = computed(() => {
  const target = toValue(options.target)
  if (!target) {
    return document.documentElement
  }

  if (target instanceof Element) {
    return target
  }

  if (target.$el instanceof Element) {
    return target.$el
  }

  throw new Error('Invalid target')
})

const style = computed(() => {
  const background = toValue(options.background) ?? '#ffeb3b'
  const color = toValue(options.color) ?? 'inherit'

  return `::highlight(${highlightName}) {
    background: ${background};
    color: ${color};
  }`
})
useStyleTag(style)
```

[`useStyleTag`](https://vueuse.org/core/useStyleTag/) æ˜¯ VueUse çš„åŠŸèƒ½ï¼Œå¯ä»¥å‹•æ…‹ç”¢ç”Ÿ `<style>` æ¨™ç±¤ä¸¦æ’å…¥æ¨£å¼ã€‚

### å»ºç«‹ `Highlight`

å»ºç«‹ `Highlight` ç‰©ä»¶èˆ‡è‡ªå‹•æ¸…é™¤é‚è¼¯ï¼š

```ts
const highlightSet = new Highlight()
tryOnMounted(() => {
  CSS.highlights.set?.(highlightName, highlightSet)
})
tryOnBeforeUnmount(() => clear())

function clear() {
  CSS.highlights.delete?.(highlightName)
  highlightSet.clear?.()
}
```

é€™å€‹éƒ¨åˆ†å°±èˆ‡å‰é¢ä»‹ç´¹çš„ `Highlight` API ç”¨æ³•ç›¸åŒã€‚

### ç”¢ç”Ÿæ¨™è¨˜

å†ä¾†æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†äº†ï¼Œè®“æˆ‘å€‘åŠ å…¥å°‹æ‰¾æ–‡å­—ã€ç”¢ç”Ÿæ¨™è¨˜çš„é‚è¼¯ï¼š

```ts
async function highlight(text: string) {
  // @ts-expect-error TS èª¤å ±
  highlightSet.clear?.()

  if (!text)
    return

  // ç¢ºä¿ DOM å·²æ›´æ–°
  await nextTick()
  await promiseTimeout(options.delay ?? 0)

  targetEl.value?.querySelectorAll('*').forEach((el) => {
    const nodeIterator = document.createNodeIterator(
      el,
      NodeFilter.SHOW_TEXT,
      {
        acceptNode(node) {
          const parentElement = node.parentElement
          // æ’é™¤ä¸è©²é€²å»çš„å€å¡Š
          if (!parentElement || /^(?:SCRIPT|STYLE|NOSCRIPT|TEXTAREA|TITLE|IFRAME)$/.test(parentElement.tagName)) {
            return NodeFilter.FILTER_REJECT
          }

          return NodeFilter.FILTER_ACCEPT
        },
      },
    )

    let node = nodeIterator.nextNode()
    while (node) {
      if (!(node instanceof Text)) {
        node = nodeIterator.nextNode()
        continue
      }

      const txt = node.data
      let index = txt.toLocaleLowerCase().indexOf(text.toLocaleLowerCase())

      while (index !== -1) {
        const range = new Range()
        range.setStart(node, index)
        range.setEnd(node, index + text.length)

        // @ts-expect-error TS èª¤å ±
        highlightSet.add?.(range)
        index = txt.indexOf(text, index + text.length)
      }
      node = nodeIterator.nextNode()
    }
  })
}
```

- ä½¿ç”¨ `NodeIterator` åªæŠ“æ–‡å­—ç¯€é»ï¼ˆSHOW_TEXTï¼‰ï¼Œä¸¦ç”¨ `acceptNode` éæ¿¾æ‰ä¸è©²æœå°‹çš„æ¨™ç±¤ã€‚
- æ¯å€‹å‘½ä¸­ç‰‡æ®µç”¨ `Range` è¨­å®šèµ·è¨–ä½ç½®ä¸¦æ”¾å…¥ `Highlight`ã€‚

### è§¸ç™¼èˆ‡æ›´æ–°

æ ¸å¿ƒé‚è¼¯å®Œæˆï¼Œæœ€å¾Œå°±æ˜¯è§¸ç™¼æ›´æ–°çš„éƒ¨åˆ†ï¼š

```ts
watchThrottled(() => ({
  textValue: toValue(text),
  waitFor: toValue(options.triggerOn),
}), async ({ textValue }) => {
  highlight(textValue)
}, {
  throttle: 100,
  leading: true,
  trailing: true,
})

useMutationObserver(targetEl, () => {
  highlight(toValue(text))
}, {
  childList: true,
  characterData: true,
  subtree: true,
})
```

é€™å€‹éƒ¨åˆ†å¾ˆå–®ç´”ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ç•¶ `text`ã€`triggerOn` æˆ– `target` è®Šå‹•æ™‚æ›´æ–°æ¨™è¨˜ã€‚

ä»¥ä¸Šæˆ‘å€‘å®Œæˆäº† `useTextHighlight` åŠŸèƒ½äº†ï¼å®Œæ•´ç¨‹å¼ç¢¼å¯ä»¥åœ¨[é€™è£¡å–å¾—](https://github.com/Codfisher/cod-aquarium/tree/main/composables/use-text-highlight.ts)ã€‚%â—( â€¢Ï‰â€¢ )â—Ÿ%

### æˆæœ

æŠŠæ­¤åŠŸèƒ½åŠ å…¥å‰›å‰›åšçš„ table ä¸­ã€‚

`content\blog-ocean-world\js-highlight-api\highlight-table.vue`

<<< ./js-highlight-api/highlight-table.vue

è¼¸å…¥æ–‡å­—çœ‹çœ‹å§ï¼

<highlight-table />

ç°¡å–®æ˜“ç”¨ï¼Œé«”é©—å¤§å¹…æå‡ï¼

é‚„å¯ä»¥è‡ªç”±èª¿æ•´æ¨™è¨˜é¡è‰²ï¼š

`content\blog-ocean-world\js-highlight-api\highlight-color.vue`

<<< ./js-highlight-api/highlight-color.vue

<div class="flex gap-4">
  <highlight-color />
  <highlight-color />
</div>

å¯ä»¥æ³¨æ„åˆ°ä¸åŒå…ƒä»¶çš„æ¨™è¨˜å®Œå…¨ä¸æœƒäº’ç›¸å¹²æ“¾ï¼%â—(â‰§âˆ€â‰¦)â—Ÿ%

## ç¸½çµ ğŸŸ

- æ¨™è¨˜ç›¸ç¬¦çš„é—œéµå­—ï¼Œå¯ä»¥æå‡ä½¿ç”¨è€…é«”é©—
- ä½¿ç”¨ Highlight API å¯ä»¥æ›´æ–¹ä¾¿åœ°å¯¦ç¾æ–‡å­—æ¨™è¨˜æ•ˆæœ
- å°è£æˆ `useTextHighlight`ï¼Œå¯ä»¥åœ¨ä¸åŒå ´æ™¯ä¸­é‡è¤‡ä½¿ç”¨
