---
title: å¥½ pipe ä¸ç”¨å—ï¼Ÿè—‰ç”± remeda è®“ç¨‹å¼ç¢¼æ›´ç°¡æ½”å½ˆæ€§å§ï¼
description: 'pipe ä»£è¡¨å‡½æ•¸å¼ç¨‹å¼è¨­è¨ˆä¸­çš„æ¦‚å¿µï¼Œåˆ©ç”¨å¤šå€‹åŠŸèƒ½çµåˆåœ¨ä¸€èµ·ï¼Œè³‡æ–™ä¾åºé€šéæ¯å€‹åŠŸèƒ½é€²è¡Œè™•ç†'
tags: ['Remeda', 'JavaScript']
image: https://codlin.me/remeda-pipe.webp
date: 20240324
---

# å¥½ pipe ä¸ç”¨å—ï¼Ÿè—‰ç”± remeda è®“ç¨‹å¼ç¢¼æ›´ç°¡æ½”å½ˆæ€§å§ï¼

![remeda-pipe](/remeda-pipe.webp){height="600"}

## ç”šéº¼æ˜¯ pipe

é¡§åæ€æ˜¯å°±æ˜¯æ°´ç®¡ï¼Œä½†æ˜¯ä¸æœƒåƒç‘ªåˆ©æ­ç”±äººä¾†é‘½ï¼Œè€Œæ˜¯è®“è³‡æ–™é€šéã€‚

pipe æ˜¯ä¸€ç¨®å‡½æ•¸å¼ç¨‹å¼è¨­è¨ˆä¸­çš„æ¦‚å¿µï¼Œç”¨ä¾†è¡¨ç¤ºä¸€æ¢è³‡æ–™è™•ç†çš„ç®¡é“ã€‚

å¯ä»¥å°‡å¤šå€‹ function çµ„åˆåœ¨ä¸€èµ·ï¼Œè³‡æ–™æœƒä¾åºç¶“éæ¯å€‹ function é€²è¡Œè™•ç†ã€‚

é€™ç¨®æ–¹æ³•ä½¿ç¨‹å¼ç¢¼æ›´åŠ æ¸…æ™°ã€æ¨¡çµ„åŒ–ï¼Œä¸¦ä¸”æ˜“æ–¼ç¶­è­·ã€‚

å€‹äººè¦ºå¾—å’Œä»¥å¾€æŒ‡ä»¤å¼çš„å¯«æ³•æœ€å¤§å·®åˆ¥åœ¨æ–¼é—œæ³¨é»ä¸åŒã€‚

æ€éº¼èªªå‘¢ï¼Ÿè®“æˆ‘å€‘çœ‹çœ‹ä»¥ä¸‹å…©ç¨®ç­‰æ•ˆçš„ç¨‹å¼ã€‚

ä¾‹ 1ï¼š

```ts
const data = [1, 2, 3]
const filteredData = data.filter((value) => value > 1)
const result = filteredData.join('-')
```

ä¾‹ 2ï¼š

```ts
const result = pipe(
  [1, 2, 3],
  filter((value) => value > 1),
  join('-'),
)
```

::: warning
æˆ‘çŸ¥é“ä½ å¾ˆæƒ³å•ä¾‹ 1 æ˜æ˜å¯ä»¥ä¸€è¡Œè§£æ±ºã€‚ç¯„ä¾‹è€Œå·²å•¦ï¼Œè®“æˆ‘å€‘æ…¢æ…¢ä¾†ã€‚(Â´ãƒ»Ï‰ãƒ»`)
:::

å¯ä»¥æ³¨æ„åˆ°ï¼š

- ä¾‹ 1 çš„å°ˆæ³¨é»åœ¨ã€Œçµæœã€
- ä¾‹ 2 çš„å¯«æ³•å°ˆæ³¨é»åœ¨ã€Œéç¨‹ã€

äº†è§£å·®ç•°å¾Œå­¸ç¿’è½‰æ›ä¸Šå°±æœƒç›¸å°å®¹æ˜“äº†ã€‚ï¼ˆæ‡‰è©²å§ áƒš(â•¹Îµâ•¹áƒš)ï¼‰

## ramdaã€remedaï¼Ÿ

é€™å…©å€‹éƒ½æ˜¯åŸºæ–¼ FP æ¦‚å¿µè¨­è¨ˆçš„å„ªç§€å¥—ä»¶ï¼Œå…¶å¯¦é¸ä¸€å€‹å–œæ­¡çš„éƒ½è¡Œã€‚

ä¸éæˆ‘ä¸»è¦ç”¨ remedaï¼Œå› ç‚º remeda å¯ä»¥å®Œç¾é…åˆ TypeScriptï¼Œè€Œä¸”åŒæ™‚æ”¯æ´ data-first èˆ‡ data-last çš„å¯«æ³•ï¼Œå…©å€‹ç¯„ä¾‹å¦‚ä¸‹ï¼š

- data-firstï¼š

```ts
const data = {
  name: 'cod',
  age: '18',
}

const result = pick(data, ['name'])
```

- data-lastï¼š

```ts
const data = {
  name: 'cod',
  age: '18',
}

const pickName = pick(['name'])
const result = pickName(data)
```

å€‹äººè¦ºå¾—ä½¿ç”¨ä¸Šæ›´ç‚ºç›´è¦ºã€‚

æ­¤å¤– remeda é‚„æœ‰å…¶ä»–ç‰¹æ€§ï¼Œè©³ç´°èªªæ˜å°±ä¸å†æ­¤è´…è¿°ï¼Œå¯ä»¥åƒè€ƒä»¥ä¸‹æ–‡ä»¶ã€‚

[Remeda](https://remedajs.com/)

## æ‰€ä»¥ pipe æœ‰ç”šéº¼å¥½è™•ï¼Ÿ

å€‹äººè¦ºå¾—æœ€å¤§çš„å¥½è™•æ˜¯ä¸ç”¨ä¸€ç›´æƒ³è®Šæ•¸åç¨± XDï¼Œè€Œä¸” function æ–¹ä¾¿æŠ½æ›ï¼Œæ•´é«”ä¾†èªªå¢åŠ äº†ç¨‹å¼çš„å½ˆæ€§ã€‚

### è®“é‚è¼¯çµæ§‹æ¸…æ™°

ä½¿ç”¨åƒæ˜¯ babylon.js é€™é¡æœ‰å¤§é‡ç‰©ä»¶çš„å¥—ä»¶æ™‚ï¼Œå¸¸å¸¸æœƒæœ‰é€™ç¨®æ”¹å¯«ç‰©ä»¶è³‡æ–™çš„éƒ¨åˆ†ã€‚

```ts
function createHole(data: ElData) {
  const depth = Math.max(data.width, data.height)

  const texture = new Texture(
    '/minecraft/textures/block/dirt.png',
    scene.value,
    true,
    false,
    Texture.NEAREST_NEAREST
  )
  /** æ–¹å¡ŠåŸºæº–å°ºå¯¸ */
  const baseSize = 80
  texture.uScale = data.width / baseSize
  texture.vScale = data.height / baseSize

  const material = new StandardMaterial('hole', scene.value)
  material.emissiveColor = new Color3(0.1, 0.1, 0.1)
  material.diffuseTexture = texture

  const hole = MeshBuilder.CreateBox(data.id, {
    width: 1,
    height: 1,
    depth,
    sideOrientation: Mesh.BACKSIDE,
  }, scene.value)

  // ä½¿ç”¨ç¸®æ”¾å°æ‡‰å¯¬é«˜ï¼Œé€™æ¨£å°±å¯ä»¥è‡ªç”±èª¿æ•´å°ºå¯¸ï¼Œè€Œä¸ç”¨è®Šæ›´ mesh
  hole.scaling.x = data.width
  hole.scaling.y = data.height
  hole.renderingGroupId = 1

  hole.material = material

  hole.position.x = data.x + data.width / 2 - windowSize.width / 2
  hole.position.y = -data.y - data.height / 2 + windowSize.height / 2
  hole.position.z = depth / 2

  hole.isVisible = !data.visible
  hole.metadata = {
    ...data,
    position: hole.position,
  }

  return hole
}
```

å…¶å¯¦ä»”ç´°ä¸€çœ‹å°±æœƒçŸ¥é“æ¯å€‹å€å¡Šçš„åŠŸèƒ½ï¼Œæ®µè½ä¹Ÿç›¸ç•¶æ˜ç¢ºï¼Œä½†æ˜¯å¦‚æœç”¨ pipe å¯«æœƒæ›´æ¸…æ™°ã€‚

è®“æˆ‘å€‘æ”¹å¯«ä¸€ä¸‹ã€‚

```ts
function createHole(data: ElData) {
  const depth = Math.max(data.width, data.height)

  const texture = pipe(
    new Texture(
      '/minecraft/textures/block/dirt.png',
      scene.value,
      true,
      false,
      Texture.NEAREST_NEAREST
    ),
    (texture) => {
      /** æ–¹å¡ŠåŸºæº–å°ºå¯¸ */
      const baseSize = 80
      texture.uScale = data.width / baseSize
      texture.vScale = data.height / baseSize

      return texture
    }
  )

  const material = pipe(
    new StandardMaterial('hole', scene.value),
    (material) => {
      material.emissiveColor = new Color3(0.1, 0.1, 0.1)
      material.diffuseTexture = texture

      return material
    },
  )

  const hole = pipe(
    MeshBuilder.CreateBox(data.id, {
      width: 1,
      height: 1,
      depth,
      sideOrientation: Mesh.BACKSIDE,
    }, scene.value),
    (hole) => {
      // ä½¿ç”¨ç¸®æ”¾å°æ‡‰å¯¬é«˜ï¼Œé€™æ¨£å°±å¯ä»¥è‡ªç”±èª¿æ•´å°ºå¯¸ï¼Œè€Œä¸ç”¨è®Šæ›´ mesh
      hole.scaling.x = data.width
      hole.scaling.y = data.height

      hole.renderingGroupId = 1
      hole.material = material

      hole.position.x = data.x + data.width / 2 - windowSize.width / 2
      hole.position.y = -data.y - data.height / 2 + windowSize.height / 2
      hole.position.z = depth / 2

      hole.isVisible = !data.visible
      hole.metadata = {
        ...data,
        position: hole.position,
      }

      return hole
    },
  )

  return hole
}
```

é€™æ¨£æ¯å€‹å€å¡Šåšçš„äº‹æƒ…æ›´åŠ æ¸…æ™°ã€‚

<br>

è·¯äººï¼šã€Œçœ‹èµ·ä¾†å¥½åƒå·®ä¸å¤šï¼Ÿ(Â´ãƒ»Ï‰ãƒ»`)ã€

é±ˆé­šï¼šã€Œçœ‹èµ·ä¾†çš„ç¢ºå·®ä¸å¤šï¼Œç¾åœ¨è®“æˆ‘å€‘é…åˆç·¨è¼¯å™¨çš„åŠŸèƒ½ã€‚áƒšï¼ˆÂ´âˆ€`áƒšï¼‰ã€

<br>

VSCode å¯ä»¥æ‘ºç–ŠæŒ‡å®šå€å¡Šï¼Œé€™æ¨£å°±å¯ä»¥ä¹¾æ·¨çš„åˆ†é–‹æ¯å€‹æ®µè½ã€‚

å¿«æ·éµå¦‚ä¸‹ï¼š

- `Ctrl + K` -> `Ctrl + J`ï¼šå±•é–‹å…¨éƒ¨å€å¡Š
- `Ctrl + K` -> `Ctrl + 0`ï¼šæ‘ºç–Šå…¨éƒ¨å€å¡Š
- `Ctrl + K` -> `Ctrl + 1`ï¼šæ‘ºç–Šç¬¬ 1 å±¤å€å¡Š
- `Ctrl + K` -> `Ctrl + 2`ï¼šæ‘ºç–Šç¬¬ 2 å±¤å€å¡Š

... ä»¥æ­¤é¡æ¨

æ‰€ä»¥æˆ‘å€‘å°±å¯ä»¥å°‡å‰›å‰›çš„ç¨‹å¼æ‘ºç–Šæˆé€™æ¨£ï¼š

```ts
function createHole(data: ElData) {
  const depth = Math.max(data.width, data.height)

  const texture = pipe(
    // ...
  )

  const material = pipe(
    // ...
  )

  const hole = pipe(
    // ...
  )

  return hole
}
```

é€™æ¨£ä¸ç®¡æ˜¯åœ¨é–±è®€æˆ–æ˜¯ç¶­è­·ä¸Šéƒ½æœƒæ›´åŠ æ–¹ä¾¿ã€‚( â€¢Ì€ Ï‰ â€¢Ì )âœ§

### è™•ç†è³‡æ–™

æ¥è‘—çœ‹çœ‹è³‡æ–™è™•ç†çš„ä¾‹å­ã€‚

å‡è¨­æˆ‘å€‘æœ‰å¤šå€‹ IoT è¨­å‚™å›å‚³è³‡æ–™ï¼Œç¶²é éœ€è¦å½™æ•´ä¸¦é¡¯ç¤ºå…§å®¹ï¼Œè³‡æ–™ç‚ºï¼š

```ts
interface Datum {
  deviceId: string;
  type: string;
  temperature: number;
  humidity: number;
  otherSensorData: Array<{
    type: string;
    value: number;
  }>;
}

const data: Datum[] = [
  {
    deviceId: 'device_1',
    type: 'A',
    temperature: 24.5,
    humidity: 50.0,
    otherSensorData: [
      { type: 'A', value: 10 },
      { type: 'A', value: 20 }
    ]
  },
  {
    deviceId: 'device_2',
    type: 'B',
    temperature: 22.3,
    humidity: 45.5,
    otherSensorData: [
      { type: 'B', value: 15 },
      { type: 'C', value: 25 }
    ]
  }
]
```

ä»¥ä¸‹è®“æˆ‘å€‘ä¾†å¯¦éš›æ’°å¯«ç¨‹å¼ã€‚

#### åˆ—å‡ºæ‰€æœ‰è¨­å‚™ ID ä¸¦ç”¨é “è™Ÿåˆ†éš”

ç†Ÿæ‚‰ JS çš„äººä¸€å®šå¯ä»¥å¾ˆå¿«å¯«å‡ºä»¥ä¸‹ç¨‹å¼ï¼š

```ts
const result01 = data
  .map(({ deviceId }) => deviceId)
  .join('ã€')
```

ç”¨ pipe å¯«å‰‡æœƒåƒé€™æ¨£ï¼š

```ts
const result02 = pipe(
  data,
  map(prop('deviceId')),
  join('ã€')
)
```

çœ‹èµ·ä¾†å¥½åƒæ²’æ¯”è¼ƒå¥½æï¼Ÿä½†æ˜¯ç”¨ remeda å¯ä»¥æ›´ç°¡å–®æŠ½é›¢èˆ‡è¤‡ç”¨ï¼š

```ts
const getDeviceIdListString = piped(
  map<Datum, string>(prop('deviceId')),
  join('ã€')
)
```

ä¹Ÿæ–¹ä¾¿åŠ å…¥æ–°çš„è™•ç†é‚è¼¯ï¼š

```ts
import { trim } from 'ramda'

const getDeviceIdListString = piped(
  /** å°‡æ¯å€‹ deviceId å»é™¤é ­å°¾ç©ºç™½ */
  map<Datum, string>(
    piped(prop('deviceId'), trim),
  ),
  join('ã€'),
)
```

é‚è¼¯è¶Šè¤‡é›œæ•ˆæœæœƒè¶Šæ˜é¡¯ï¼Œä¾†çœ‹çœ‹å…¶ä»–ä¾‹å­ã€‚

#### å°‡è¨­å‚™ä¾ç…§ type åˆ†é¡

```ts
const groupByType = pipe(
  data,
  groupBy(prop('type')),
  values,
)
```

#### å–å¾—å¹³å‡æº«åº¦èˆ‡å¹³å‡æ¿•åº¦

```ts
const meanData = {
  temperature: pipe(data, meanBy(prop('temperature'))),
  humidity: pipe(data, meanBy(prop('humidity'))),
}
```

#### å–å¾— otherSensorData type ç¨®é¡æ¸…å–®

```ts
const typeList = pipe(
  data,
  /** å°‡æ‰€æœ‰ otherSensorData æ”¤å¹³ã€çµ„æˆæ–°çŸ©é™£ */
  flatMap(prop('otherSensorData')),
  /** ä¾ç…§ type æ•¸å€¼å»é™¤é‡è¤‡é …ç›® */
  uniqBy(prop('type')),
  /** å–å‡º type æ•¸å€¼ç”¢ç”Ÿæ–°çŸ©é™£ */
  map(prop('type'))
)
```

#### å–å¾—æ‰€æœ‰æº«æº¼åº¦ä¸åœ¨èˆ’é©ç¯„åœå…§çš„è¨­å‚™

```ts
function isComfortableTemperature(value: number) {
  return value >= 22 && value <= 28
}
function isComfortableHumidity(value: number) {
  return value >= 40 && value <= 60
}

const isComfortable = piped(
  allPass<Datum>([
    piped(prop('temperature'), isComfortableTemperature),
    piped(prop('humidity'), isComfortableHumidity),
  ])
)

const uncomfortableList = pipe(data, reject(isComfortable))

/**
 * å› ç‚ºåªæœ‰ä¸€å€‹åƒæ•¸ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨ data-first çš„æ–¹å¼å¯«
 * const result = reject(data, isComfortable);
 */
```

å¾ä»¥ä¸Šä¾‹å­ä¾†çœ‹ï¼Œå…¶å¯¦å°±ç®—æ²’æœ‰è¨»è§£ï¼Œå¾ function çš„åç¨±æˆ‘å€‘çœ‹å¾—å‡ºä¾†æ­¤ç¨‹å¼åœ¨åšç”šéº¼ã€‚( â€¢Ì€ Ï‰ â€¢Ì )âœ§

é€™æ¨£å¯è®€æ€§æ˜¯ä¸æ˜¯æå‡äº†è¨±å¤šå‘¢ï¼Ÿå¦‚æœæ²’æœ‰ï¼Œå°±å†å¤šçœ‹å¹¾æ¬¡ï¼ˆï¼Ÿ

å¦‚æœéŒ¯èª¤æˆ–æ›´å¥½çš„åšæ³•ï¼Œæ­¡è¿å¤§å®¶å¤šå¤šæŒ‡æ•™ã€‚(Â´â–½ï½€)

## ç¸½çµ ğŸŸ

- pipe å¯å°‡å¤šå€‹åŠŸèƒ½ä¸²è¯ï¼Œè³‡æ–™ä¾åºé€šéæ¯å€‹åŠŸèƒ½é€²è¡Œè™•ç†
- remeda å¯ä»¥å®Œç¾é…åˆ TypeScriptï¼ŒåŒæ™‚æ”¯æ´ data-first èˆ‡ data-last çš„å¯«æ³•
- ä½¿ç”¨ pipe å¯ä»¥è®“ç¨‹å¼ç¢¼çµæ§‹æ›´åŠ æ¸…æ™°ã€æ¨¡çµ„åŒ–ï¼Œä¸¦ä¸”æ˜“æ–¼ç¶­è­·
