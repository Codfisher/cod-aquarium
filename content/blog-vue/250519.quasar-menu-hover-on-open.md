---
title: å¹« Quasar Menu åŠ ä¸Š hover é–‹å•ŸåŠŸèƒ½
description: åŸæœ¬æƒ³èªªæ‡‰è©²å¾ˆç°¡å–®ï¼Œä»”ç´°æ¢è¨å¾Œç™¼ç¾äº‹æƒ…æ²’æœ‰åƒæ†¨é­šæƒ³çš„é‚£éº¼ç°¡å–®ã€‚%(â—‰â—à±ªâ—Ÿâ—‰ )%
tags: ['Vue', 'Quasar']
image: https://codlin.me/quasar-menu-hover-on-open.webp
date: 20250519
---

![quasar-menu-hover-on-open](/quasar-menu-hover-on-open.webp){.cover}

# å¹« Quasar Menu åŠ ä¸Š hover é–‹å•ŸåŠŸèƒ½

æœ€è¿‘é‡åˆ° Menu æƒ³è¦ä½¿ç”¨ hover é–‹å•Ÿçš„éœ€æ±‚ï¼Œä¸é Quasar çš„ Menu é è¨­æ²’æœ‰é€™å€‹åŠŸèƒ½ï¼Œåªå¥½è‡ªè¡Œè™•ç†äº†ã€‚%â—( â€¢Ï‰â€¢ )â—Ÿ%

åŸæœ¬æƒ³èªªæ‡‰è©²å¾ˆç°¡å–®ï¼Œä»”ç´°æ¢è¨å¾Œç™¼ç¾äº‹æƒ…æ²’æœ‰åƒæ†¨é­šæƒ³çš„é‚£éº¼ç°¡å–®ã€‚%(â—‰â—à±ªâ—Ÿâ—‰ )%

::: tip ä¸åƒ…ç”¨æ–¼ Quasar Menu
é›–ç„¶é€™ç¯‡é‡å° Quasar Menu é–‹ç™¼ï¼Œä½†æ­¤é‚è¼¯æ²’æœ‰ç¶å®š Quasar Menu ç‰¹æœ‰åŠŸèƒ½ï¼Œæ‰€ä»¥å¾®èª¿å¾Œä¹Ÿå¯ç”¨æ–¼å…¶ä»– UI å¥—ä»¶çš„ Menuï¼Œ~~~æ‡‰è©²å•¦ %(ã‚âˆ€ãƒ»)b%~~~ã€‚
:::

## éœ€æ±‚

æ‰€æœ‰çš„é–‹ç™¼ç¬¬ä¸€æ­¥éƒ½æ˜¯é‡æ¸…éœ€æ±‚ã€‚

ç”šéº¼ï¼Ÿä½ èªªæ²’æœ‰éœ€æ±‚æ€éº¼è¾¦ï¼Ÿé‚£å°±é–‹å§‹é€šéˆå§ï¼%(ã€‚-`Ï‰Â´-)%


### åŸºæœ¬éœ€æ±‚

- ç•¶æ»‘é¼  hover åœ¨æŒ‰éˆ•ï¼ˆæˆ–è§¸ç™¼å™¨ï¼‰ä¸Šæ™‚ï¼ŒMenu è‡ªå‹•é–‹å•Ÿã€‚
- æ»‘é¼ å¾æŒ‰éˆ•ç§»å‡ºæ™‚ï¼š
  - ç§»è‡³ Menu ä¸Šï¼ŒMenu ä¿æŒé–‹å•Ÿ
  - å¦å‰‡ Menu é—œé–‰

### å¤šå±¤ç´šå–®é¸å–®

å‡è¨­é–‹å•Ÿäº† 3 å±¤ï¼Œå‰‡ï¼š

- æ»‘é¼ é›¢é–‹ç¬¬ 3 å±¤å›åˆ°ç¬¬ 2 å±¤æ™‚ï¼Œç¬¬ 3 å±¤æ¶ˆå¤±
- ç›´æ¥é›¢é–‹ç¬¬ 3 å±¤è‡³é é¢ï¼Œæ‰€æœ‰é¸å–®æ¶ˆå¤±
- ç›´æ¥å›åˆ°ç¬¬ä¸€å±¤ï¼Œç¬¬ 2ã€3 å±¤é—œé–‰

### ä½¿ç”¨éœ€æ±‚

å…ˆä¾†è¤‡ç¿’ä¸€ä¸‹ [Quasar Menu ç”¨æ³•](https://quasar.dev/vue-components/menu)ã€‚

ç”¨æ³•å¾ˆç°¡å–®ï¼Œåªè¦åœ¨é æœŸç”¢ç”Ÿ Menu çš„å…ƒç´ å…§æ”¾å…¥ `q-menu` å³å¯ã€‚

```vue
<template>
  <q-btn
    color="primary"
    label="Basic Menu"
  >
    <q-menu>
      <q-list>
        <q-item v-close-popup clickable>
          <q-item-section>New tab</q-item-section>
        </q-item>
        <q-item v-close-popup clickable>
          <q-item-section>New incognito tab</q-item-section>
        </q-item>
      </q-list>
    </q-menu>
  </q-btn>
</template>
```

è¨ˆç•«é–‹ç™¼ä¸€å€‹å…ƒä»¶ï¼Œå¯ä»¥ç„¡ç—›æ›¿æ› Quasar Menuï¼Œå‡è¨­å«åš `menu-hover`ã€‚

åªè¦åƒé€™æ¨£ç°¡å–®æ›¿æ›å³å¯ã€‚

```vue
<template>
  <q-btn
    color="primary"
    label="Basic Menu"
  >
    <menu-hover>
      // ...
    </menu-hover>
  </q-btn>
</template>
```

## æ¶æ§‹

ä¸»è¦æœ‰å…©å€‹å·¥ä½œï¼Œæ¦‚å¿µå¦‚ä¸‹åœ–æ‰€ç¤ºï¼š

1. æ³¨å…¥ä¸€å€‹ç´€éŒ„ Menu å±¤ç´šçš„è®Šæ•¸
1. root menu æ³¨å…¥æ”¶é›† child è³‡æ–™ä¹‹ function

![menu-hover æ¶æ§‹åœ–](/quasar-menu-hover-on-open/menu-hover-æ¶æ§‹åœ–.png)

ç”±æ–¼è¦å‚³éæœªçŸ¥å±¤ç´šçš„è³‡æ–™ï¼Œé è¨ˆä½¿ç”¨ [Vue çš„ Provide/Inject](https://vuejs.org/guide/components/provide-inject) è™•ç†ã€‚

## é–‹ç™¼

### props èˆ‡ hover é‚è¼¯

ç¾åœ¨ä¾†å¯¦éš›é–‹ç™¼å§ï¼Œé¦–å…ˆå¾æœ€åŸºæœ¬çš„ props é–‹å§‹ã€‚

å› ç‚ºè¦å¯ä»¥ç„¡ç—›æ›¿æ›åŸæœ¬çš„ `q-menu`ï¼Œæ‰€ä»¥éœ€è¦ç¹¼æ‰¿ `q-menu` çš„ propsã€‚

::: tip
ç‚ºäº†å–®ç´”ä¸€é»ï¼Œé€™æ¬¡æ’é™¤ `target` å’Œ `modelValue`ï¼Œæœ‰éœ€è¦å†æƒ³è¾¦æ³•åŠ é€²ä¾†ã€‚
:::

`src/components/menu-hover/menu-hover.vue`

```vue
<script setup lang="ts">
import type { QMenuProps } from 'quasar'

interface Props extends Omit<QMenuProps, 'modelValue' | 'target'> {
  disableHoverOpen?: boolean;
}
const props = withDefaults(defineProps<Props>(), {
  disableHoverOpen: false,
})
</script>
./type./type
```

æ¥ä¸‹ä¾†æ˜¯è§¸ç™¼å™¨èˆ‡ menu è‡ªå·±æœ¬èº«çš„ hover é‚è¼¯ã€‚

`src/components/menu-hover/menu-hover.vue`

```vue
<template>
  <q-menu
    ref="menuRef"
    @mouseenter="handleMenuHover"
    @mouseleave="handleMenuLeave"
  >
    <slot />
  </q-menu>
</template>

<script setup lang="ts">
// ...

// è¾¨è­˜å…ƒä»¶ï¼ŒVue 3.5 ä¹‹å¾Œå¯ä»¥ç›´æ¥ä½¿ç”¨ useId()
const id = crypto.randomUUID()

const triggerEl = useParentElement()
const isTriggerHover = useElementHover(triggerEl, {
  delayLeave: 100,
})

const menuRef = ref<InstanceType<typeof QMenu>>()
const isMenuHover = ref(false)
const handleMenuLeave = debounce(() => {
  isMenuHover.value = false
}, 100)
function handleMenuHover() {
  isMenuHover.value = true
  handleMenuLeave.cancel()
}
</script>
```

é€™è£¡ä½¿ç”¨ `VueUse` æä¾›çš„ `useParentElement` èˆ‡ `useElementHover` ç°¡å–®å®Œæˆã€‚

menu çš„éƒ¨åˆ†å‰‡æ˜¯å› ç‚º `useElementHover` æ”¾å…¥å…ƒä»¶æ²’æœ‰ä½œç”¨ï¼Œæ‰€ä»¥æ”¹ç”¨æ™®é€šçš„ `mouseenter` èˆ‡ `mouseleave` è™•ç†ã€‚

::: tip

menuRef èˆ‡ `useElementHover` ç›®å‰åšéä»¥ä¸‹å˜—è©¦ã€‚

é€™æ¨£å¯« TS ä¸é–‹å¿ƒï¼š

```ts
useElementHover(menuRef, {
  delayLeave: 100,
})
```

é€™æ¨£å¯«æ²’åæ‡‰ï¼š

```ts
useElementHover(() => menuRef.value?.$el, {
  delayLeave: 100,
})
```

è‹¥æœ‰å¤§å¤§çŸ¥é“æ€éº¼åšï¼Œé‚„è«‹ä¸åå‘Šè¨´æˆ‘ï¼(*Â´âˆ€`)~â™¥
:::

### æ³¨å…¥ level ä¸¦è’é›† child menu è³‡æ–™

å…ˆä¾†å®šç¾©å½¢åˆ¥è³‡æ–™ã€‚

`src/components/menu-hover/type.ts`

```ts
import type { InjectionKey, Ref } from 'vue'

export interface MenuData {
  id: string;
  level: number;
}

export const menuLevelInjectionKey = Symbol('menu-level') as InjectionKey<number>

export const menuInjectionKey = Symbol('menu-hover') as InjectionKey<{
  bindSubmenu: (data: MenuData) => void;
  unbindSubmenu: (id: string) => void;
  submenuList: Ref<MenuData[]>;
}>
```

ä¸¦åœ¨å…ƒä»¶å¼•ç”¨ã€‚

`src/components/menu-hover/menu-hover.vue`

```vue
// ...

<script setup lang="ts">
import type { MenuData } from './type'
import { computed, inject, provide, ref } from 'vue'
import { injectionKey } from './type'

// ...

/** åªæœ‰ root menu ä½¿ç”¨ï¼Œchild menu æ‡‰è©²ä½¿ç”¨ currentSubmenuList */
const submenuList = ref<MenuData[]>([])

const rootProvider = inject(injectionKey, null)
const currentSubmenuList = computed(() => rootProvider?.submenuList.value ?? [])

// ç´€éŒ„ç›®å‰æ˜¯ç¬¬å¹¾å±¤ menu
const menuLevel = inject(menuLevelInjectionKey, 0)
provide(menuLevelInjectionKey, menuLevel + 1)

function bindSubmenu(data: MenuData) {
  /** æ¸…æ‰åŒä¸€å±¤è€…ï¼Œå› ç‚ºåŒå±¤åŒæ™‚åªæœƒé¡¯ç¤ºä¸€å€‹ */
  submenuList.value = submenuList.value.filter((item) => item.level !== data.level)
  submenuList.value.push(data)
}
function unbindSubmenu(id: string) {
  const index = submenuList.value.findIndex((item) => item.id === id)
  if (index !== -1) {
    submenuList.value.splice(index, 1)
  }
}
// åªæœ‰ root menu provide
if (!rootProvider) {
  provide(injectionKey, {
    bindSubmenu,
    unbindSubmenu,
    submenuList,
  })
}
</script>
```

åŸºæœ¬ä¸Šå°±æ˜¯ç•¶ child menu é¡¯ç¤ºæ™‚ï¼Œå°‡è‡ªå·±çš„è³‡æ–™å‚³éçµ¦ root menuï¼Œéš±è—ã€æ¶ˆå¤±æ™‚ç§»é™¤è³‡æ–™ã€‚

ä¸¦é€é `menu-level` ç´€éŒ„ç›®å‰æ˜¯ç¬¬å¹¾å±¤ï¼Œé€™æ¨£ root èˆ‡ child éƒ½å¯ä»¥å¾—çŸ¥ç›®å‰æ•´é«” Menu tree ç‹€æ…‹äº†ã€‚

æœ‰ç‹€æ…‹å¾Œï¼Œè¦åˆ¤æ–· hover é‚è¼¯å°±ç°¡å–®å¤šäº†ã€‚

### é–‹å•Ÿé¸å–®

æœ€å¾Œå°±æ˜¯å¯¦éš›é–‹å•Ÿ Menu çš„éƒ¨åˆ†äº†ï¼Œä½¿ç”¨ `menuVisible` ä¾†æ§åˆ¶ Menu çš„é¡¯ç¤ºèˆ‡éš±è—ã€‚

æœ‰ 3 ç¨®æ–¹å¼æœƒè§¸ç™¼ Menu é¡¯ç¤ºï¼š

1. è§¸ç™¼å™¨ hover
2. Menu hover
3. è‡ªå·±çš„å­é¸å–®é–‹å•Ÿ

```vue
<template>
  <q-menu
    ref="menuRef"
    v-model="menuVisible"
    v-bind="props"
    @mouseenter="handleMenuHover"
    @mouseleave="handleMenuLeave"
  >
    <slot />
  </q-menu>
</template>

<script setup lang="ts">
// ...

const menuVisible = ref(false)
const hasSubmenuVisible = computed(() => {
  if (menuLevel === 0 && submenuList.value.length > 0) {
    return true
  }

  const visible = currentSubmenuList.value.some(({ level }) => level > menuLevel)

  // è‡ªå·±ä¹Ÿè¦é¡¯ç¤ºæ‰ç®—æ˜¯è‡ªå·±çš„ submenu
  return visible && menuVisible.value
})

watch(() => [
  isTriggerHover,
  isMenuHover,
  hasSubmenuVisible,
], () => {
  if (props.disableHoverOpen) {
    return
  }

  menuVisible.value = isTriggerHover.value || isMenuHover.value || hasSubmenuVisible.value
}, { deep: true })

watch(menuVisible, (value) => {
  if (value) {
    rootProvider?.bindSubmenu({
      id,
      level: menuLevel,
    })
  }
  else {
    rootProvider?.unbindSubmenu(id)
  }
})

onBeforeUnmount(() => {
  rootProvider?.unbindSubmenu(id)
})
</script>
```

ä»¥ä¸Šæˆ‘å€‘å®Œæˆ hover é–‹å•Ÿçš„é‚è¼¯äº†ã€‚

è‹¥æœ‰å“ªå€‹éƒ¨åˆ†è§£è§£é‡‹å¾—ä¸å¤ æ¸…æ¥šæˆ–æœ‰å¤§ç¥çŸ¥é“æ›´ç°¡æ½”çš„æ–¹æ³•ï¼Œé‚„è«‹ä¸åå‘Šè¨´æˆ‘ã€‚%à©­ Ë™á—œË™ )à©­%

å®Œæ•´åŸå§‹ç¢¼[åœ¨é€™è£¡](https://github.com/Codfisher/blog-quasar-menu-open-on-hover)

æƒ³å˜—è©¦çœ‹çœ‹çš„æœ‹å‹å¯ä»¥[é»é€™è£¡](https://stackblitz.com/~/github.com/Codfisher/blog-quasar-menu-open-on-hover?file=src/components/menu-hover/menu-hover.vue)

## ç¸½çµ ğŸŸ

- å¾®èª¿å¾Œå¯ä»¥ç”¨æ–¼å…¶ä»– UI å¥—ä»¶çš„ Menu
- ä½¿ç”¨ Vue çš„ Provide/Inject ä¾†å‚³éæœªçŸ¥å±¤ç´šçš„è³‡æ–™
