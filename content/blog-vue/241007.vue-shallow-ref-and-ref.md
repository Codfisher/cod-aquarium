---
title: Vue çš„ shallowRef æ˜¯å•¥ï¼Ÿå’Œ ref æœ‰ç”šéº¼å·®åˆ¥ï¼Ÿ
description: ç†Ÿæ‚‰ Vue çš„æœ‹å‹å€‘ä¸€å®šçŸ¥é“ `ref` æ˜¯å•¥ï¼Œä¸€èµ·ä¾†çœ‹çœ‹ `shallowRef` å’Œ `ref` æœ‰ç”šéº¼å·®åˆ¥å§ï¼Ô…( Ë˜Ï‰Ë˜Ô…)
tags: ['Vue']
image: https://codlin.me/vue-shallow-ref-and-ref.webp
pubDate: 20241007
---

<script setup>
  import SimpleExample from './vue-shallow-ref-and-ref/simple-example.vue'
  import HeavyData from './vue-shallow-ref-and-ref/heavy-data.vue'
</script>

![vue-shallow-ref-and-ref](/vue-shallow-ref-and-ref.webp){.cover}

# Vue çš„ shallowRef æ˜¯å•¥ï¼Ÿå’Œ ref æœ‰ç”šéº¼å·®åˆ¥ï¼Ÿ

ç†Ÿæ‚‰ Vue çš„æœ‹å‹å€‘ä¸€å®šçŸ¥é“ `ref` æ˜¯å•¥ã€‚Ô…( Ë˜Ï‰Ë˜Ô…)

ä¸çŸ¥é“å¤§å®¶æœ‰æ²’æœ‰æ³¨æ„åˆ° Vue é‚„æœ‰ä¸€å€‹åå­—æœ‰é»åƒçš„ APIï¼Œå«åš `shallowRef`ã€‚

`shallowRef` å’Œ `ref` æœ‰ç”šéº¼å·®åˆ¥å‘¢ï¼Ÿ

é¡§åæ€ç¾©ï¼Œç°¡å–®ä¾†èªª `shallowRef` åªå°æ·ºå±¤ï¼ˆç¬¬ä¸€å±¤ï¼‰é€²è¡ŒéŸ¿æ‡‰å¼è™•ç†ã€‚

ä¹Ÿå°±æ˜¯èªªä»¥ä¸‹ç¨‹å¼ç¢¼ã€‚

<<< ./vue-shallow-ref-and-ref/simple-example.vue

<simple-example class="border border-gray-400/50 p-4 rounded" />

ç•¶æˆ‘å€‘é»æ“Šã€Œæ›´æ–°è³‡æ–™ã€æŒ‰éˆ•æ™‚ï¼Œ<span v-pre>`{{ shallowData.cod.length }}`</span> éƒ¨åˆ†ä¸æœƒè¢«æ›´æ–°ï¼Œæ–‡å­—æœƒä¿æŒ shallowData: 0ã€‚

é™¤é `updateShallowData` å…§å®¹æ”¹æˆï¼š

```ts
async function updateShallowData() {
  const cod = [...shallowData.value.cod, 'fish']
  shallowData.value = { cod }
}
```

é€™æ¨£å°±æœƒå› ç‚ºç¬¬ä¸€å±¤ï¼Œä¹Ÿå°±æ˜¯ `shallowData.value` çš„å€¼è¢«æ”¹è®Šï¼Œæ‰æœƒè§¸ç™¼éŸ¿æ‡‰ï¼Œè®“ç•«é¢æ›´æ–°ã€‚

æˆ–è€…ä½¿ç”¨ `triggerRef` è§¸ç™¼éŸ¿æ‡‰ä¹Ÿå¯ä»¥ã€‚

```ts
async function updateShallowData() {
  shallowData.value.cod.push('fish')
  triggerRef(shallowData)
}
```

çœ‹åˆ°é€™è£¡ä½ å¯èƒ½æœƒæƒ³ã€Œæ€éº¼æå¾—æ›´éº»ç…©äº†ï¼Ÿáƒšï¼ˆÂ´å£`áƒšï¼‰ã€

åˆ¥æ€¥åˆ¥æ€¥ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹ç‚ºç”šéº¼éœ€è¦ `shallowRef` é€™å€‹ç©æ„å…’ã€‚

## shallowRef çš„ä½¿ç”¨å ´æ™¯

å…ˆä¾†å€‹å·¥ç¨‹å¸«çš„å¥½ç¿’æ…£ï¼Œç¬¬ä¸€æ­¥å…ˆçœ‹çœ‹[æ–‡ä»¶å¯«ç”šéº¼](https://vuejs.org/api/reactivity-advanced.html)ã€‚

å…¶å¯¦æ–‡ä»¶èªªå¾—å¾ˆæ¸…æ¥šï¼Œä¸»è¦ç›®çš„æ˜¯ç‚ºäº†ã€Œæ€§èƒ½è€ƒé‡ã€èˆ‡ã€Œå¤–éƒ¨ç‹€æ…‹ç®¡ç†æ•´åˆã€ã€‚

æ–‡ä»¶ä¹Ÿçµ¦äº†å…·é«”ä¾‹å­ï¼š

- [Guide - Reduce Reactivity Overhead for Large Immutable Structures](https://vuejs.org/guide/best-practices/performance#reduce-reactivity-overhead-for-large-immutable-structures)
- [Guide - Integration with External State Systems](https://vuejs.org/guide/extras/reactivity-in-depth#integration-with-external-state-systems)

### å¤§å‹ç‰©ä»¶

å°æ•´å€‹é¾å¤§ç‰©ä»¶é€²è¡ŒéŸ¿æ‡‰å¼è™•ç†ï¼Œæœƒå°è‡´æ€§èƒ½ä¸‹é™ã€‚

åªçœ‹æ–‡å­—èªªæ˜ä¸å¤ å…·é«”ï¼Œè®“æˆ‘å€‘ç”¨ç¨‹å¼ç¢¼è­‰æ˜çœ‹çœ‹å§ã€‚

è€ƒæ…®ä»¥ä¸‹ç¨‹å¼ç¢¼ã€‚

<<< ./vue-shallow-ref-and-ref/heavy-data.vue

ä»¥ä¸Šç¨‹å¼çš„é‚è¼¯ç‚ºï¼š

1. `createData` å»ºç«‹ä¸€å€‹é•·åº¦ 10000 çš„å¤§å‹ç‰©ä»¶ã€‚
1. åˆ†åˆ¥ä½¿ç”¨ `ref` å’Œ `shallowRef` å° `createData` çš„çµæœé€²è¡ŒåŒ…è£ã€‚
1. `performance.now()` ç´€éŒ„æ›´æ–°è³‡æ–™æ‰€éœ€æ™‚é–“ã€‚

<heavy-data class="border border-gray-400/50 p-4 rounded" />

åœ¨æˆ‘çš„é›»è…¦ä¸Š `ref` å¤§ç´„éœ€è¦ 7msï¼Œ`shallowRef` å¤§ç´„éœ€è¦ 0.1msã€‚

å¯ä»¥æ³¨æ„åˆ° `shallowData` çš„æ›´æ–°æ™‚é–“æ¯” `data` å¿«äº†è¿‘ 70 å€ï¼%( â€¢Ì€ Ï‰ â€¢Ì )âœ§%

<br>

è·¯äººï¼šã€Œé›–ç„¶å·® 10 å€ï¼Œä½†å¯¦éš›ä¸Šä¹Ÿæ‰èŠ±äº† 7msï¼Œå¹³å¸¸ä¹Ÿç”¨ä¸åˆ°é€™éº¼å¤§çš„ç‰©ä»¶ï¼Œé€™æ¨£æ˜¯ä¸æ˜¯ä¸ç”¨ `shallowRef` ä¹Ÿç„¡æ‰€è¬‚å•Šï¼Ÿ%(*Â´ï½¥Ğ´ï½¥)?%ã€

é±ˆé­šï¼šã€Œä½ èªªæ²’éŒ¯ %(*Â´,,â€¢Ï‰â€¢,,)%ï¼Œå¹³å¸¸å¾ˆé›£é‡åˆ°å¤§å‹ç‰©ä»¶ï¼Œä¸éé‚„è¦æ˜¯æ³¨æ„ä¸€äº›æƒ…å¢ƒã€‚ã€

### é…åˆç¬¬ä¸‰æ–¹å¥—ä»¶

ç•¶ä½ ä½¿ç”¨ pixiã€babylon.js é€™é¡å¥—ä»¶æ™‚ï¼Œå¥—ä»¶æœ¬èº«æœƒå»ºç«‹å„ç¨®è¤‡é›œç‰©ä»¶ï¼Œä¾‹å¦‚ï¼šEngineã€Sceneã€Mesh ç­‰ç­‰ã€‚

é›–ç„¶ä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œå®Œå…¨ä¸éœ€è¦ `ref`ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚

```ts
// âŒ ä¸éœ€è¦ ref åŒ…è£
const engine = ref(new Engine(canvas, true))

// âœ…
const engine = new Engine(canvas, true)
```

ä½†æ˜¯æœ‰æ™‚å€™é‚„æ˜¯éœ€è¦éŸ¿æ‡‰æ€éº¼è¾¦ï¼Ÿé€™å€‹æ™‚å€™å°±å¯ä»¥ç”¨ `shallowRef` äº†ï¼%à©­ Ë™á—œË™ )à©­%

ç›´æ¥ä½¿ç”¨ `ref` åŒ…è£ï¼Œæœƒè®“ç•«é¢æœƒå¡åˆ°çˆ†ç‚¸å–”ã€‚

é™¤äº†å¡åˆ°ç‚¸ä»¥å¤–ï¼Œ`ref` çš„ `Proxy` é‚„æœ‰å¯èƒ½ç ´å£å¥—ä»¶çš„å…§éƒ¨é‚è¼¯ï¼Œå°è‡´å¥—ä»¶ç„¡æ³•æ­£å¸¸é‹ä½œã€‚

ä¾‹å¦‚ä»¥ä¸‹ issueï¼š

- [Bug: When Application is proxied by Vue 3(ref), an error occurs when rendering graphics](https://github.com/pixijs/pixijs/issues/10477)

å¯ä»¥çœ‹åˆ°è£¡é¢æåˆ°çš„è§£æ³•ä¹Ÿæ˜¯ç”¨ `shallowRef` è§£æ±ºã€‚%â—( â€¢Ï‰â€¢ )â—Ÿ%

::: tip
ä¾‹å¦‚é…·é…·å…ƒä»¶ä¸­çš„ [useBabylonScene](https://gitlab.com/side_project/chill-component/-/blob/main/src/composables/use-babylon-scene.ts?ref_type=heads#L67)ï¼Œç”¨æ–¼å¿«é€Ÿå»ºç«‹ä¸€å€‹ 3D å ´æ™¯ã€‚å…¶ä¸­çš„ babylon.js ç›¸é—œç‰©ä»¶å°±æ˜¯ä½¿ç”¨ `shallowRef` åŒ…è£ã€‚
:::

å†é€²éšä¸€é»é‚„å¯ä»¥è€ƒæ…®ä½¿ç”¨ `customRef`ï¼Œä¸éé€™å€‹å°±ç•™åˆ°æœªä¾†æœ‰æ©Ÿæœƒå†èŠå•¦ã€‚%( Â´ â–½ ` )ï¾‰%

## ç¸½çµ ğŸŸ

- `shallowRef` åªå°ç¬¬ä¸€å±¤é€²è¡ŒéŸ¿æ‡‰å¼è™•ç†ï¼Œé©åˆå¤§å‹ç‰©ä»¶ã€‚
- é…åˆç¬¬ä¸‰æ–¹å¥—ä»¶çš„è¤‡é›œç‰©ä»¶æ™‚ï¼Œä½¿ç”¨ `shallowRef` å¯ä»¥é¿å…ç ´å£ç‰©ä»¶å…§éƒ¨é‚è¼¯æˆ–æ‹–å®æ€§èƒ½ã€‚
