---
description: Directive 內沒有沒有自動解除的魔法呦
tags: ['Vue']
image: https://codlin.me/img.webp
pubDate: 202
---

![img](/img.webp){.cover}

# 自動解除的魔法呢？Vue Directive 和 Effect Scope

Vue 除了元件與 Composition API 外，還有很方便的自定義 [Directive](https://cn.vuejs.org/guide/reusability/custom-directives)。

Directive 裡面能不能使用 VueUse 呢？當然可以啦，哪次不行了。%◝( •ω• )◟%

所以可以這樣寫：

```ts
export const vTest: Directive = {
  mounted(el, binding) {
    if (!(el instanceof HTMLElement)) {
      return
    }

    const bounding = useElementBounding(el)

    watch(bounding, (value) => {
      console.log('bounding: ', value)
    }, { deep: true })
  },
}
```

當元素尺寸變化時，`watch` 會順利觸發。

寫起來簡單快樂，但是當元件被被移除時，指令中 `watch` 並不會自動解除呦。

## 總結 🐟
