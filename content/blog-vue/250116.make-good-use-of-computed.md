---
title: å–„ç”¨ computed
description: å¸¸è½èªªä¸è¦æŠŠè¤‡é›œçš„è¡¨é”å¼å¯«åœ¨ template è£¡ï¼Œæ‡‰å…ˆç”¨ computed è£èµ·ä¾†ï¼Œä¾†è©¦è©¦æœ‰ç”šéº¼å·®åˆ¥å§ã€‚áƒšï¼ˆÂ´âˆ€`áƒšï¼‰
tags: ['Vue']
image: https://codlin.me/make-good-use-of-computed.webp
date: 20250117
---

# å–„ç”¨ computed

![make-good-use-of-computed](/make-good-use-of-computed.webp)

å¸¸è½èªªä¸è¦æŠŠè¤‡é›œçš„è¡¨é”å¼å¯«åœ¨ template è£¡ï¼Œæ‡‰å„ªå…ˆç”¨ computed è£èµ·ä¾†å†æ”¾åˆ° template ä¸­ã€‚

è½èªªæ­¸è½èªªï¼Œ~~è‹“è†é¾œè‹“è†~~ï¼Œä¾†è©¦è‘—æ¢è¨çœ‹çœ‹å§ã€‚%( Â´ â–½ ` )ï¾‰%

::: tip
Vue å®˜æ–¹ Style Guide ä¹‹ã€ŒPriority B Rules: Strongly Recommendedã€ä¸­æœ‰ã€Œ[Simple expressions in templates](https://vuejs.org/style-guide/rules-strongly-recommended.html#simple-expressions-in-templates)ã€

ä¸éè¦å‰‡é‚„æ˜¯è¦ä¾ç…§åœ˜éšŠå…§æ¡ç”¨è¦ç¯„ç‚ºä¸»ã€‚%Ô…( Ë˜Ï‰Ë˜Ô…)%
:::

## è½èªªæ€§èƒ½æœ‰å·®ï¼Ÿ

è¨­è¨ˆä¸€å€‹ç¹é‡çš„è¨ˆç®—æ–¹ä¾¿æ¯”è¼ƒå·®åˆ¥ï¼Œä¾†çœ‹çœ‹ computed èˆ‡ template çµæœã€‚

`utils.ts`

```ts
export function getFibonacci(n: number): number {
  if (n <= 1)
    return n
  return getFibonacci(n - 1) + getFibonacci(n - 2)
}
```

å°±æ˜¯ä¸€å€‹ç¶“å…¸çš„è²»æ°æ•¸åˆ—è¨ˆç®—ã€‚

æ¥è‘—è¨­è¨ˆå…©å€‹å…ƒä»¶ï¼Œä¸€å€‹ä½¿ç”¨ computedï¼Œä¸€å€‹ç›´æ¥åœ¨ template è£¡è¨ˆç®—ã€‚

`components/ComputedCalc.vue`

```vue
<script setup lang="ts">
import { useIntervalFn } from '@vueuse/core'
import { computed, nextTick, ref } from 'vue'
import { getFibonacci } from '../utils'

const n = ref(30)
const key = ref('')

const result = computed(() => getFibonacci(n.value))

useIntervalFn(
  async () => {
    key.value = crypto.randomUUID()

    console.time('computed')
    await nextTick()
    console.timeEnd('computed')
  },
  3000,
  {
    immediateCallback: true,
  }
)
</script>

<template>
  <div>
    <h1>computed</h1>
    <div :key>
      {{ result }}
    </div>
  </div>
</template>
```

`components/TemplateCalc.vue`

```vue
<script setup lang="ts">
import { useIntervalFn } from '@vueuse/core'
import { nextTick, ref } from 'vue'
import { getFibonacci } from '../utils'

const n = ref(30)
const key = ref('')

useIntervalFn(
  async () => {
    key.value = crypto.randomUUID()

    console.time('template')
    await nextTick()
    console.timeEnd('template')
  },
  3000,
  {
    immediateCallback: true,
  }
)
</script>

<template>
  <div>
    <h1>template</h1>
    <div :key>
      {{ getFibonacci(n) }}
    </div>
  </div>
</template>
```

ä¸»è¦é‚è¼¯ç‚ºï¼š

- é€é `useIntervalFn` æ¯ 3 ç§’æ›´æ–°ä¸€æ¬¡ `key`ï¼Œè§¸ç™¼ template æ›´æ–°
- `console.time` è¨ˆç®— template æ›´æ–°æ‰€éœ€çš„æ™‚é–“
- `ComputedCalc.vue` ä½¿ç”¨ `computed` å„²å­˜ `getFibonacci` çµæœ
- `TemplateCalc.vue` å‰‡ç›´æ¥åœ¨ `template` è£¡å‘¼å« `getFibonacci`ã€‚

æ¥è‘—æˆ‘å€‘åœ¨ `App.vue` ä¸­ä¾†æ¸¬è©¦é€™å…©å€‹å…ƒä»¶ã€‚

`App.vue`

```vue
<script setup>
import { ref } from 'vue'
import ComputedCalc from './components/ComputedCalc.vue'
import TemplateCalc from './components/TemplateCalc.vue'

const toggle = ref(true)
</script>

<template>
  <input v-model="toggle" type="checkbox">åˆ‡æ›</input>
  <computed-calc v-if="toggle" />
  <template-calc v-else />
</template>
```

åˆ‡æ› `checkbox` æœƒåœ¨ devtool çš„ console çœ‹åˆ° computed èˆ‡ template çš„æ™‚é–“å·®ç•°ã€‚

ç¯„ä¾‹ç¨‹å¼ç¢¼[åœ¨æ­¤](https://stackblitz.com/edit/make-good-use-of-computed-rnmb827u?file=src%2FApp.vue)

console çš„å…§å®¹å¦‚ä¸‹

```text
computed: 16.491943359375 ms
computed: 0.996826171875 ms

template: 12.89794921875 ms
template: 12.85302734375 ms

computed: 13.27294921875 ms
computed: 0.20703125 ms
computed: 0.18408203125 ms

template: 15.92578125 ms
template: 12.6689453125 ms
template: 12.741943359375 ms
```

å¯ä»¥æ³¨æ„åˆ°è¨ˆç®— `getFibonacci(30)` çš„æ™‚é–“ï¼Œå…©è€…åŸºæœ¬ä¸Šå·®ä¸å¤šï¼Œæœ€å¤§çš„å·®åˆ¥åœ¨æ–¼ `computed` åªæœ‰ç¬¬ä¸€æ¬¡è¨ˆç®—æ™‚æœƒèŠ±è¼ƒå¤šæ™‚é–“ã€‚

é€™å°±æ˜¯å®˜æ–‡æ–‡ä»¶æåˆ°çš„ [Computed Caching](https://vuejs.org/guide/essentials/computed#computed-caching-vs-methods) æ•ˆæœï¼Œåªæœ‰åœ¨ reactive dependency æ”¹è®Šæ™‚æ‰æœƒé‡æ–°è¨ˆç®—ã€‚

æ‰€ä»¥ä¸ç®¡ template å¦‚ä½•æ›´æ–°ï¼Œéƒ½ä¸æœƒè§¸ç™¼é¡å¤–çš„è¨ˆç®—ã€‚

å¾é€™å€‹çµæœä¾†çœ‹ï¼Œå–„ç”¨ `computed` æœ€å¤§çš„å„ªé»æ˜¯å¯ä»¥æ¸›å°‘ä¸å¿…è¦çš„è¨ˆç®—ï¼Œæå‡æ•ˆèƒ½ã€‚

## æ€§èƒ½ä¹‹å¤–å‘¢ï¼Ÿ

è·¯äººï¼šã€Œä¸€èˆ¬æ‰ä¸æœƒæœ‰é€™éº¼ç¹é‡çš„è¨ˆç®—ï¼Œæ‰€ä»¥æ˜¯ä¸æ˜¯æ²’å·®ï¼Ÿ%(ã€‚-`Ï‰Â´-)%ã€

é±ˆé­šï¼šã€Œçš„ç¢ºï¼Œä½ èªªçš„æ²’éŒ¯ã€‚%(Â´,,â€¢Ï‰â€¢,,)%ã€

<br>

é›–ç„¶èªªå…ƒä»¶ä¸­è‹¥æœ‰ä¸€å †ä¸å¿…è¦çš„è¨ˆç®—ï¼Œå¯èƒ½æœƒæœ‰ç©å°‘æˆå¤šï¼Œå°è‡´æ€§èƒ½ä¸ä½³çš„éƒ¨åˆ†ã€‚

ä½†æ ¹æ“šå€‹äººä¸€ç›´ä»¥ä¾†çš„é–‹ç™¼ç¶“é©—ï¼Œä¸»è¦çš„æ€§èƒ½ç“¶é ¸éƒ½ä¸æ˜¯é€™é¡å•é¡Œï¼Œé€šå¸¸éƒ½æ˜¯ DOM å¤ªå¤šå°è‡´ç•«é¢å¡é “ã€‚

ã€Œæ€§èƒ½æ¯”è¼ƒå¥½ã€ï¼Œé€™å€‹ç†ç”±å€‹äººè¦ºå¾—ä¸å¤ å……åˆ†ï¼Œä¸é `computed` é™¤äº†æ€§èƒ½ä¹‹å¤–ï¼Œé‚„æœ‰å…¶ä»–å„ªé»ï¼Œä¾‹å¦‚ï¼š

### æ–¹ä¾¿é™¤éŒ¯

é…åˆ [debugger](https://vuejs.org/guide/extras/reactivity-in-depth.html#computed-debugging)ï¼Œæ–¹ä¾¿è¿½è¹¤éŸ¿æ‡‰éç¨‹ã€‚

```ts
const plusOne = computed(() => count.value + 1, {
  onTrack(e) {
    // triggered when count.value is tracked as a dependency
    debugger
  },
  onTrigger(e) {
    // triggered when count.value is mutated
    debugger
  }
})
```

### æ–¹ä¾¿æ¸¬è©¦

`computed` çš„å…§å®¹æ”¾åˆ° `defineExpose` ä¸­ï¼Œå°±å¯ä»¥åœ¨å–®å…ƒæ¸¬è©¦ä¸­æ¸¬è©¦ã€‚

```vue
<script setup>
import { computed, defineExpose, ref } from 'vue'
import { getFibonacci } from '../utils'

const n = ref(0)
const result = computed(() => getFibonacci(n.value))

defineExpose({ result })
</script>
```

é€™ä¸€é»èˆ‡ Style Guide ä¸­çš„ã€Œ[Simple computed properties](https://vuejs.org/style-guide/rules-strongly-recommended.html#simple-computed-properties)ã€çš„ç†å¿µæœ‰é»é¡ä¼¼ã€‚

é™¤äº†æ›´å®¹æ˜“æ¸¬è©¦å¤–ï¼Œå‘½åæº–ç¢ºçš„ `computed` ä¹Ÿèƒ½æå‡ç¨‹å¼ç¢¼çš„å¯è®€æ€§ã€‚

## çœŸçš„ä¸å¥½å—ï¼Ÿ(*Â´ï½¥Ğ´ï½¥)

æ‰€ä»¥æŠŠè¡¨é”å¼æ”¾åœ¨ `template` ä¸­ï¼ŒçœŸçš„å¾ˆä¸å¥½å—ï¼Ÿ

æˆ‘è‡ªå·±æ˜¯è¦ºå¾—ä¸‹é¢é€™ç¨®æƒ…æ³ï¼Œé‚„æ˜¯å¾ˆå¯ä»¥æ¥å—çš„å•¦ã€‚%Ô…(Â´âˆ€` Ô…)%

```vue
<template>
  <div :class="{ active: isActive }">
    <h1>{{ i + 1 }}</h1>

    <div :style="{ color: isActive ? 'red' : 'blue' }">
      å®‰å®‰ä½ å¥½
    </div>
  </div>
</template>
```

é€™é¡ä¾‹å­è¦æ˜¯ç”¨ `computed` è£èµ·ä¾†ï¼Œå‘½åä¹Ÿä¸å¤ªå¥½æƒ³ã€‚

ä½†ä¸‹é¢é€™ç¨®å°±æœ‰é»éåˆ†äº†ã€‚%(ã€‚-`Ï‰Â´-)%

```vue
<template>
  <div>
    <div
      :style="{
        color: message.length > 10 ? 'red' : 'blue',
        fontSize: message.length > 10 ? '20px' : '16px',
        letterSpacing: message.length > 10 ? '2px' : '1px',
        fontWeight: message.length > 10 ? 'bold' : 'normal',
      }"
    >
      {{ message }}
    </div>

    ç¸½åˆç‚º {{
      data
        .filter((item) => item.name === 'cod')
        .map((item) => item.price)
        .reduce((acc, cur) => acc + cur, 0)
    }}
  </div>
</template>

<script setup lang="ts">
const message = ref('å®‰å®‰ä½ å¥½')
const data = ref([
  { name: 'cod', price: 18 },
  { name: 'cod', price: 20 },
  { name: 'cod', price: 22 },
])
</script>
```

å»ºè­°ç”¨ `computed` è£èµ·ä¾†å§ã€‚%(*Â´âˆ€`)~â™¥%

```vue
<template>
  <div>
    <div :style="messageStyle">
      {{ message }}
    </div>

    ç¸½åˆç‚º {{ total }}
  </div>
</template>

<script setup lang="ts">
import type { CSSProperties } from 'vue'
import { computed } from 'vue'

const message = ref('å®‰å®‰ä½ å¥½')
const messageStyle = computed<CSSProperties>(() => ({
  color: message.value.length > 10 ? 'red' : 'blue',
  fontSize: message.value.length > 10 ? '20px' : '16px',
  letterSpacing: message.value.length > 10 ? '2px' : '1px',
  fontWeight: message.value.length > 10 ? 'bold' : 'normal',
}))

const data = ref([
  { name: 'cod', price: 18 },
  { name: 'cod', price: 20 },
  { name: 'cod', price: 22 },
])
const total = computed(() => {
  return data.value
    .filter((item) => item.name === 'cod')
    .map((item) => item.price)
    .reduce((acc, cur) => acc + cur, 0)
})
</script>
```

## åŒå ´åŠ æ˜ 

è·¯äººï¼šã€Œå¦‚æœçœŸçš„æœ‰ç¹é‡çš„è¨ˆç®—éœ€æ±‚ï¼Œæœ‰ç”šéº¼æ–¹æ³•å—ï¼Ÿã€

é±ˆé­šï¼šã€Œå¯ä»¥è«‹æ‰“å·¥ä»”æ”¯æ´ã€‚%á••( ï¾Ÿ âˆ€ã€‚)á•— %ã€

è·¯äººï¼šã€Œ...ï¼Ÿ%( ãƒ»à¸´Ï‰ãƒ»à¸´)%ã€

<br>

Web Worker å¯ä»¥åœ¨èƒŒæ™¯åŸ·è¡Œçš„ç¨ç«‹åŸ·è¡Œç·’ ï¼Œå¯ä»¥é¿å…ä¸»åŸ·è¡Œç·’è¢«é˜»å¡ã€‚

æˆ‘çš„é…·é…·å…ƒä»¶çš„[è½é›ªæ•ˆæœ](https://chillcomponent.codlin.me/components/bg-snow/)ä¹Ÿæ˜¯ç”¨ Web Worker è¨ˆç®—é›ªèŠ±å‹•æ…‹èˆ‡ç¢°æ’åµæ¸¬ã€‚

å³ä½¿é›ªèŠ±è¶…é 10 è¬å€‹ï¼ŒFPS å¾ˆä½ï¼Œä¹Ÿä¸æœƒè®“ç¶²é å¡é “ã€‚%( â€¢Ì€ Ï‰ â€¢Ì )âœ§%

::: tip æ‰€ä»¥æˆ‘èªªé‚£å€‹æ”¯æ´åº¦å‘¢ï¼Ÿ
æˆªè‡³ 2025/01/17 ç‚ºæ­¢ï¼Œ[æ”¯æ´åº¦](https://caniuse.com/webworkers)é”åˆ°äº† 98.19%ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥å¿«æ¨‚ä½¿ç”¨ï¼âœ§â‘ï½¡Ù©(ËŠá—œË‹*)Ùˆâœ§â•ï½¡
:::

VueUse æœ‰ä¸€å€‹ [`useWebWorkerFn`](https://vueuse.org/core/useWebWorkerFn/#usewebworkerfn) å¯ä»¥ç°¡åŒ– Web Worker çš„ä½¿ç”¨ã€‚

ä¾†è©¦è©¦çœ‹å§ã€‚%à©­ Ë™á—œË™ )à©­%

`components/WorkerCalc.vue`

```vue
<script setup lang="ts">
import {
  useDateFormat,
  useIntervalFn,
  useTimestamp,
  useWebWorkerFn,
} from '@vueuse/core'
import { ref } from 'vue'
import { getFibonacci } from '../utils'

const time = useTimestamp()
const computedTime = useDateFormat(time, 'YYYY-MM-DD HH:mm:ss SSS')
const result = ref(0)

const { workerFn } = useWebWorkerFn((n: number) => getFibonacci(n), {
  timeout: 50000,
  localDependencies: [getFibonacci],
})

useIntervalFn(
  async () => {
    console.time('worker')
    result.value = await workerFn(40)
    console.timeEnd('worker')
  },
  3000,
  {
    immediateCallback: true,
  }
)
</script>

<template>
  <div>
    <h1>worker</h1>
    <div>
      {{ result }}
    </div>

    <div>{{ computedTime }}</div>
  </div>
</template>
```

æ¯ 3 ç§’è¨ˆç®—ä¸€æ¬¡ n=40 çš„è²»æ°æ•¸åˆ—ï¼Œä¸¦ä¸”é¡¯ç¤ºç›®å‰æ™‚é–“ã€‚

æ¥è‘—åœ¨ `App.vue` ä¸­åŠ å…¥ `WorkerCalc`ã€‚

`App.vue`

```vue
<script setup>
import { ref } from 'vue'
import ComputedCalc from './components/ComputedCalc.vue'
import TemplateCalc from './components/TemplateCalc.vue'
import WorkerCalc from './components/WorkerCalc.vue' // [!code ++]

const toggle = ref(true)
</script>

<template>
  <input v-model="toggle" type="checkbox">åˆ‡æ›</input>
  <computed-calc v-if="toggle" />
  <template-calc v-else />

  <worker-calc /> // [!code ++]
</template>
```

ç¾åœ¨ console æœƒå¤šå‡º worker çš„è¨ˆç®—æ™‚é–“ã€‚

```text
worker: 959.0419921875 ms
worker: 996.47998046875 ms
worker: 980.422119140625 ms
```

å¯ä»¥æ³¨æ„åˆ°å³ä½¿èŠ±äº†å°‡è¿‘ 1 ç§’è¨ˆç®—ï¼Œç¶²é ä¾èˆŠå¾ˆæµæš¢ã€‚%âœ§â‘ï½¡Ù©(ËŠá—œË‹*)Ùˆâœ§â•ï½¡%

## ç¸½çµ ğŸŸ

- `computed` æœ‰è‘— `Computed Caching` çš„æ•ˆæœï¼Œåªæœ‰åœ¨ reactive dependency æ”¹è®Šæ™‚æ‰æœƒé‡æ–°è¨ˆç®—ï¼Œå¯ä»¥æ¸›å°‘ä¸å¿…è¦çš„è¨ˆç®—ã€‚
- `computed` é™¤äº†æ€§èƒ½ä¹‹å¤–ï¼Œé‚„æœ‰æ–¹ä¾¿é™¤éŒ¯ã€æ¸¬è©¦ã€æå‡å¯è®€æ€§ç­‰å„ªé»ã€‚
- ç¹é‡çš„è¨ˆç®—å¯ä»¥è€ƒæ…®äº¤çµ¦ Web Workerï¼Œé¿å…ç¶²é å¡åˆ°æ­ªã€‚
