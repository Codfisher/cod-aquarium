---
title: å–„ç”¨ computed
description: å¸¸è½èªªä¸è¦æŠŠè¤‡é›œçš„è¡¨é”å¼å¯«åœ¨ template è£¡ï¼Œæ‡‰å…ˆç”¨ computed è£èµ·ä¾†ï¼Œä¾†è©¦è©¦æœ‰ç”šéº¼å·®åˆ¥å§ã€‚áƒšï¼ˆÂ´âˆ€`áƒšï¼‰
tags: ['Vue']
image: https://codlin.me/make-good-use-of-computed.webp
date: 20250116
---

# å–„ç”¨ computed

![make-good-use-of-computed](/make-good-use-of-computed.webp)

å¸¸è½èªªä¸è¦æŠŠè¤‡é›œçš„è¡¨é”å¼å¯«åœ¨ template è£¡ï¼Œæ‡‰å„ªå…ˆç”¨ computed è£èµ·ä¾†å†æ”¾åˆ° template ä¸­ã€‚

è½èªªæ­¸è½èªªï¼Œä¾†è©¦è‘—æ¢è¨çœ‹çœ‹å§ã€‚%( Â´ â–½ ` )ï¾‰%

::: tip
Vue å®˜æ–¹ Style Guide ä¹‹ã€ŒPriority B Rules: Strongly Recommendedã€ä¸­æœ‰ã€Œ[Simple expressions in templates](https://vuejs.org/style-guide/rules-strongly-recommended.html#simple-expressions-in-templates)ã€

ä¸éé€™å€‹é‚„æ˜¯è¦çœ‹åœ˜éšŠè¦ç¯„ã€‚%Ô…( Ë˜Ï‰Ë˜Ô…)%
:::

## è½èªªæ€§èƒ½æœ‰å·®ï¼Ÿ

è¨­è¨ˆä¸€å€‹ç¹é‡çš„è¨ˆç®—æ–¹ä¾¿æ¯”è¼ƒå·®åˆ¥ï¼Œä¾†çœ‹çœ‹ computed èˆ‡ template çµæœã€‚

`utils.ts`

```ts
export function getFibonacci(n: number): number {
  if (n <= 1)
    return n
  return getFibonacci(n - 1) + getFibonacci(n - 2)
}
```

å°±æ˜¯ä¸€å€‹ç¶“å…¸çš„è²»æ°æ•¸åˆ—è¨ˆç®—ã€‚

æ¥è‘—è¨­è¨ˆå…©å€‹å…ƒä»¶ï¼Œä¸€å€‹ä½¿ç”¨ computedï¼Œä¸€å€‹ç›´æ¥åœ¨ template è£¡è¨ˆç®—ã€‚

`components/ComputedCalc.vue`

```vue
<script setup lang="ts">
import { useIntervalFn } from '@vueuse/core'
import { computed, nextTick, ref } from 'vue'
import { getFibonacci } from '../utils'

const n = ref(30)
const key = ref('')

const result = computed(() => getFibonacci(n.value))

useIntervalFn(
  async () => {
    key.value = crypto.randomUUID()

    console.time('computed')
    await nextTick()
    console.timeEnd('computed')
  },
  3000,
  {
    immediateCallback: true,
  }
)
</script>

<template>
  <div>
    <h1>computed</h1>
    <div :key>
      {{ result }}
    </div>
  </div>
</template>
```

`components/TemplateCalc.vue`

```vue
<script setup lang="ts">
import { useIntervalFn } from '@vueuse/core'
import { nextTick, ref } from 'vue'
import { getFibonacci } from '../utils'

const n = ref(30)
const key = ref('')

useIntervalFn(
  async () => {
    key.value = crypto.randomUUID()

    console.time('template')
    await nextTick()
    console.timeEnd('template')
  },
  3000,
  {
    immediateCallback: true,
  }
)
</script>

<template>
  <div>
    <h1>template</h1>
    <div :key>
      {{ getFibonacci(n) }}
    </div>
  </div>
</template>
```

ä½¿ç”¨ `console.time` è¨ˆç®— template æ›´æ–°æ‰€éœ€çš„æ™‚é–“ã€‚

`ComputedCalc.vue` ä½¿ç”¨ `computed` å„²å­˜ `getFibonacci` çµæœï¼Œ`TemplateCalc.vue` å‰‡ç›´æ¥åœ¨ `template` è£¡å‘¼å« `getFibonacci`ã€‚

æ¥è‘—æˆ‘å€‘åœ¨ `App.vue` ä¸­ä¾†æ¸¬è©¦é€™å…©å€‹å…ƒä»¶ã€‚

`App.vue`

```vue
<script setup>
import { ref } from 'vue'
import ComputedCalc from './components/ComputedCalc.vue'
import TemplateCalc from './components/TemplateCalc.vue'

const toggle = ref(true)
</script>

<template>
  <input v-model="toggle" type="checkbox">åˆ‡æ›</input>
  <computed-calc v-if="toggle" />
  <template-calc v-else />
</template>
```

åˆ‡æ› `checkbox` æœƒåœ¨ devtool çš„ console çœ‹åˆ° computed èˆ‡ template çš„æ™‚é–“å·®ç•°ã€‚

ç¯„ä¾‹ç¨‹å¼ç¢¼[åœ¨æ­¤](https://stackblitz.com/edit/make-good-use-of-computed-rnmb827u?file=src%2FApp.vue)

console çš„å…§å®¹å¦‚ä¸‹

```
computed: 16.491943359375 ms
computed: 0.996826171875 ms
template: 12.89794921875 ms
template: 12.85302734375 ms
computed: 13.27294921875 ms
computed: 0.20703125 ms
computed: 0.18408203125 ms
template: 15.92578125 ms
template: 12.6689453125 ms
template: 12.741943359375 ms
```

å¯ä»¥æ³¨æ„åˆ°è¨ˆç®— `getFibonacci(30)` çš„æ™‚é–“ï¼Œå…©è€…åŸºæœ¬ä¸Šå·®ä¸å¤šï¼Œæœ€å¤§çš„å·®åˆ¥åœ¨æ–¼ `computed` åªæœ‰ç¬¬ä¸€æ¬¡è¨ˆç®—æ™‚æœƒèŠ±è¼ƒå¤šæ™‚é–“ï¼Œä¹‹å¾Œéƒ½æ˜¯æ¯«ç§’ç´šåˆ¥ã€‚

é€™å€‹å°±æ˜¯å®˜æ–‡æ–‡ä»¶æåˆ°çš„ [Computed Caching](https://vuejs.org/guide/essentials/computed#computed-caching-vs-methods) æ•ˆæœï¼Œåªæœ‰åœ¨ reactive dependency æ”¹è®Šæ™‚æ‰æœƒé‡æ–°è¨ˆç®—ã€‚

å¾é€™å€‹çµæœä¾†çœ‹ï¼Œå–„ç”¨ `computed` æœ€å¤§çš„å„ªé»æ˜¯å¯ä»¥æ¸›å°‘ä¸å¿…è¦çš„è¨ˆç®—ï¼Œæå‡æ•ˆèƒ½ã€‚

## æ€§èƒ½ä¹‹å¤–å‘¢ï¼Ÿ

è·¯äººï¼šã€Œä¸€èˆ¬æ‰ä¸æœƒæœ‰é€™éº¼ç¹é‡çš„è¨ˆç®—ï¼Œé€™æ¨£æ˜¯ä¸æ˜¯æ²’å·®ï¼Ÿ%(ã€‚-`Ï‰Â´-)%ã€

é±ˆé­šï¼šã€Œçš„ç¢ºï¼Œä½ èªªçš„æ²’éŒ¯ã€‚%(Â´,,â€¢Ï‰â€¢,,)%ã€

<br>

é›–ç„¶èªªå¯èƒ½æœƒæœ‰ç©å°‘æˆå¤šï¼Œå°è‡´æ€§èƒ½ä¸ä½³çš„éƒ¨åˆ†ã€‚

ä½†æ ¹æ“šå€‹äººä¸€ç›´ä»¥ä¾†çš„é–‹ç™¼ç¶“é©—ï¼Œä¸»è¦çš„æ€§èƒ½ç“¶é ¸éƒ½ä¸æ˜¯é€™é¡å•é¡Œï¼Œé€šå¸¸éƒ½æ˜¯ DOM å¤ªå¤šå°è‡´ç•«é¢å¡é “ã€‚

ã€Œæ€§èƒ½æ¯”è¼ƒå¥½ã€ï¼Œé€™å€‹ç†ç”±æ²’æœ‰ç›¸ç•¶å……åˆ†ï¼Œä¸é `computed` é™¤äº†æ€§èƒ½ä¹‹å¤–ï¼Œé‚„æœ‰å…¶ä»–å„ªé»ï¼Œä¾‹å¦‚ï¼š

### æ–¹ä¾¿é™¤éŒ¯

é…åˆ [debugger](https://vuejs.org/guide/extras/reactivity-in-depth.html#computed-debugging)ï¼Œæ–¹ä¾¿è¿½è¹¤éŸ¿æ‡‰éç¨‹ã€‚

```ts
const plusOne = computed(() => count.value + 1, {
  onTrack(e) {
    // triggered when count.value is tracked as a dependency
    debugger
  },
  onTrigger(e) {
    // triggered when count.value is mutated
    debugger
  }
})
```

### æ–¹ä¾¿æ¸¬è©¦

`computed` çš„å…§å®¹æ”¾åˆ° `defineExpose` ä¸­ï¼Œå°±å¯ä»¥åœ¨å–®å…ƒæ¸¬è©¦ä¸­æ¸¬è©¦ã€‚

```vue
<script setup>
import { computed, defineExpose, ref } from 'vue'
import { getFibonacci } from '../utils'

const n = ref(0)
const result = computed(() => getFibonacci(n.value))

defineExpose({ result })
</script>
```

é€™ä¸€é»èˆ‡ Style Guide ä¸­çš„ã€Œ[Simple computed properties](https://vuejs.org/style-guide/rules-strongly-recommended.html#simple-computed-properties)ã€çš„ç†å¿µæœ‰é»é¡ä¼¼ã€‚

é™¤äº†æ›´å®¹æ˜“æ¸¬è©¦å¤–ï¼Œå‘½åæº–ç¢ºçš„ `computed` ä¹Ÿèƒ½æå‡ç¨‹å¼ç¢¼çš„å¯è®€æ€§ã€‚

## çœŸçš„ä¸å¥½å—ï¼Ÿ(*Â´ï½¥Ğ´ï½¥)

æ‰€ä»¥æŠŠè¡¨é”å¼æ”¾åœ¨ `template` ä¸­ï¼ŒçœŸçš„å¾ˆä¸å¥½å—ï¼Ÿ

æˆ‘è‡ªå·±æ˜¯è¦ºå¾—ä¸‹é¢é€™ç¨®æƒ…æ³ï¼Œé‚„æ˜¯å¾ˆå¯ä»¥æ¥å—çš„å•¦ã€‚%Ô…(Â´âˆ€` Ô…)%

```vue
<template>
  <div :class="{ active: isActive }">
    <h1>{{ i + 1 }}</h1>

    <div :style="{ color: isActive ? 'red' : 'blue' }">
      å®‰å®‰ä½ å¥½
    </div>
  </div>
</template>
```

é€™é¡ä¾‹å­è¦æ˜¯ç”¨ `computed` è£èµ·ä¾†ï¼Œå‘½åä¹Ÿä¸å¤ªå¥½æƒ³ã€‚

ä½†ä¸‹é¢é€™ç¨®å°±æœ‰é»éåˆ†äº†ã€‚%(ã€‚-`Ï‰Â´-)%

```vue
<template>
  <div>
    <div
      :style="{
        color: message.length > 10 ? 'red' : 'blue',
        fontSize: message.length > 10 ? '20px' : '16px',
        letterSpacing: message.length > 10 ? '2px' : '1px',
        fontWeight: message.length > 10 ? 'bold' : 'normal',
      }"
    >
      {{ message }}
    </div>

    ç¸½åˆç‚º {{
      data
        .filter((item) => item.name === 'cod')
        .map((item) => item.price)
        .reduce((acc, cur) => acc + cur, 0)
    }}
  </div>
</template>
```

å»ºè­°ç”¨ `computed` è£èµ·ä¾†å§ã€‚%(*Â´âˆ€`)~â™¥%

```vue
<template>
  <div>
    <div :style="messageStyle">
      {{ message }}
    </div>

    ç¸½åˆç‚º {{ total }}
  </div>
</template>

<script setup lang="ts">
import type { CSSProperties } from 'vue'
import { computed } from 'vue'

const message = ref('å®‰å®‰ä½ å¥½')
const messageStyle = computed<CSSProperties>(() => ({
  color: message.value.length > 10 ? 'red' : 'blue',
  fontSize: message.value.length > 10 ? '20px' : '16px',
  letterSpacing: message.value.length > 10 ? '2px' : '1px',
  fontWeight: message.value.length > 10 ? 'bold' : 'normal',
}))

const data = ref([
  { name: 'cod', price: 18 },
  { name: 'cod', price: 20 },
  { name: 'cod', price: 22 },
])
const total = computed(() => {
  return data.value
    .filter((item) => item.name === 'cod')
    .map((item) => item.price)
    .reduce((acc, cur) => acc + cur, 0)
})
</script>
```

## ç¸½çµ ğŸŸ
