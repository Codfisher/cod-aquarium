---
title: è—‰ç”± Vue h function è®“ Quasar Dialog æ›´ç°¡å–®è¤‡ç”¨
description: Quasar Dialog çš„ Invoking custom component å¾ˆå¥½ç”¨ï¼Œä½†æ˜¯æœ‰äº›å›°æ“¾çš„åœ°æ–¹ï¼Œä¸€èµ·ä¾†çœ‹çœ‹æœ‰ç”šéº¼è¾¦æ³•å§ã€‚
tags: ['Vue', 'Quasar']
image: https://codlin.me/vue-h-function-makes-quasar-dialog-easier-to-reuse.webp
date: 20240715
---

# è—‰ç”± Vue h function è®“ Quasar Dialog æ›´ç°¡å–®è¤‡ç”¨

![vue-h-function-makes-quasar-dialog-easier-to-reuse](/vue-h-function-makes-quasar-dialog-easier-to-reuse.webp){.cover}

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯é±ˆé­šã€‚ï¼ˆï¼¾âˆ€ï¼¾â—ï¼‰ï¾‰ï½¼

Quasar æ˜¯ä¸€å€‹åŸºæ–¼ Vue çš„å…¨ç«¯æ¡†æ¶ï¼Œå…·é«”å…§å®¹å¯ä»¥çœ‹çœ‹[å®˜æ–¹æ–‡ä»¶ä»‹ç´¹](https://quasar.dev/introduction-to-quasar#what-is-quasar)ã€‚

ä¸éç›®å‰æˆ‘ä¸»è¦é‚„æ˜¯æŠŠ Quasar ç•¶ UI å¥—ä»¶ç”¨ã€‚(â•¯â–½â•° )

## Quasar çš„ Invoking custom component

Quasar çš„ Dialog æœ‰ä¸€å€‹å¾ˆæœ‰è¶£çš„åŠŸèƒ½ï¼Œåœ¨æ–‡ä»¶ç¨±ç‚ºã€Œ[Invoking custom component](https://quasar.dev/quasar-plugins/dialog#invoking-custom-component)ã€ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä»¥å‘½ä»¤å¼ï¼ˆimperativeï¼‰å‘¼å«ä»»ä½•è‡ªå®šç¾©çš„ Dialog å…ƒä»¶ã€‚

é€™åœ¨å»ºç«‹è¤‡é›œçš„å¾Œå°ç³»çµ±å¾ˆæ–¹ä¾¿ï¼Œé™¤äº†å…ƒä»¶å¯ä»¥ä½œç‚º Dialog é‡è¤‡ä½¿ç”¨ï¼Œæ›´å¯ä»¥ä¿æŒ template ä¹¾æ·¨ï¼Œä¸æœƒå……æ»¿å¤§é‡èˆ‡ç›®å‰å…ƒä»¶é‚è¼¯ç„¡é—œçš„ html å…§å®¹ï¼Œè®“ç¨‹å¼ç¢¼æ›´ç°¡æ½”ã€å…§èšä¸€é»ã€‚

ä½†æ˜¯æœ‰å€‹å°å›°æ“¾ï¼Œæ–‡ä»¶è¡¨ç¤ºå¿…é ˆå…ˆå°‡å…ƒä»¶åŒ…è£¹æ–¼ q-dialog ä¸¦èª¿ç”¨ useDialogPluginComponentï¼Œ

ä¹Ÿå°±æ˜¯èªªæˆ‘æœ‰ä¸€å€‹ CreateForm å…ƒä»¶è¦è®Šæˆ Dialogï¼Œè¦å»ºç«‹ä¸€å€‹æ–°å…ƒä»¶ï¼š

`CreateFormDialog.vue`

```vue
<template>
  <q-dialog ref="dialogRef" @hide="onDialogHide">
    <create-form>
      <!--
        ...content
        ... use q-card-section for it?
      -->
    </create-form>
  </q-dialog>
</template>

<script setup>
import { useDialogPluginComponent } from 'quasar'
import CreateForm from './components/create-form.vue'

const props = defineProps({
  // ...your custom props
})

defineEmits([
  ...useDialogPluginComponent.emits
])

const { dialogRef, onDialogHide, onDialogOK, onDialogCancel } = useDialogPluginComponent()

function onOKClick() {
  onDialogOK()
}
</script>
```

æ¥è‘—ä½¿ç”¨ $q.dialog å‘¼å«ï¼š

```ts
$q.dialog({
  component: CreateFormDialog,
})
```

æˆåŠŸæŠŠ CreateForm è®Šæˆ Dialog é–‹å•Ÿäº†ï¼Ë‹( Â° â–½ã€Â° )

ä¸éé€™æ¨£æœƒå°è‡´æ¯æœ‰ä¸€å€‹å…ƒä»¶æƒ³ä»¥ Dialog å½¢å¼é–‹å•Ÿï¼Œå°±æœƒå¤šä¸€å€‹ xxxDialog.vue çš„è®Šé«”å…ƒä»¶ï¼Œå¯¦åœ¨æ˜¯æœ‰é»éº»ç…©ä¸”å¤šé¤˜ã€‚

ä½†æ˜¯æˆ‘å€‘çŸ¥é“ï¼Œå…¶å¯¦ Vue å…§éƒ¨çš„ VDOM éƒ½æ˜¯é€é h function å»ºç«‹ï¼Œæ‰€ä»¥å…¶å¯¦æˆ‘å€‘å¯ä»¥åˆ©ç”¨ h function ç°¡åŒ–é€™å€‹éç¨‹ã€‚

::: tip
h function å°±æ˜¯æ‰€è¬‚çš„æ¸²æŸ“å‡½æ•¸ï¼Œè©³ç´°èªªæ˜å¯ä»¥[çœ‹çœ‹å®˜æ–¹æ–‡ä»¶](https://cn.vuejs.org/guide/extras/render-function.html)
:::

h function çš„å¯«æ³•å¾ˆç°¡å–®ï¼Œå…¶åƒæ•¸ä¾é †åºå¦‚ä¸‹ï¼š

1. typeï¼šé™¤äº† html tag å¤–ï¼Œä¹Ÿå¯ä»¥æ˜¯ Vue çš„å…ƒä»¶ã€‚
2. propsï¼šDOM çš„åƒæ•¸ï¼Œä¹Ÿå¯ä»¥æ˜¯å…ƒä»¶çš„ propã€‚
3. childrenï¼šæ­¤ DOM çš„å­å…ƒç´ ï¼Œä¹Ÿå¯ä»¥æ˜¯å…ƒä»¶çš„ slot

```ts
import { h } from 'vue'

const vnode = h(
  'div', // type
  { id: 'foo', class: 'bar' }, // props
  [
    /* children */
  ]
)
```

æ›å¥è©±èªªï¼Œå‰›å‰›çš„ç¨‹å¼ç¢¼ï¼š

```ts
$q.dialog({
  component: CreateFormDialog,
})
```

å¯ä»¥é€é h function æ”¹å¯«æˆï¼š

```ts
$q.dialog({
  component: h(
    QDialog,
    {},
    { default: () => h(CreateForm) }
  )
})
```

é±ˆé­šï¼šã€Œé€™æ¨£å°±ä¸ç”¨ä¸€ç›´å»ºç«‹ Dialog è®Šé«”å…ƒä»¶äº†ï¼(â‰§âˆ‡â‰¦)ï¾‰ã€

è·¯äººï¼šã€Œé€™æ¨£ç¨‹å¼ç¢¼çœ‹èµ·ä¾†å¾ˆå¯æ€•æ¬¸ã€‚(ï¾ŸĞ”ï¾Ÿ*)ï¾‰ã€

é±ˆé­šï¼šã€Œä¹Ÿæ˜¯æï¼Œè®“æˆ‘å€‘é‡æ§‹ã€å°è£ä¸€ä¸‹ã€‚(ï½¡ï½¥âˆ€ï½¥)ï¾‰ï¾ã€

## é‡æ§‹ã€å°è£

é¦–å…ˆç¬¬ä¸€æ­¥ï¼Œè®“æˆ‘å€‘å»ºç«‹å”åŠ©æå–å…ƒä»¶å‹åˆ¥çš„å¯¦ç”¨ functionã€‚

`src/types/utils.type.ts`

```ts
/** æå– Vue Component ä¹‹å…§éƒ¨ props
 *
 * æœƒå°‡ styleã€classã€event å…¨éƒ¨å–å‡ºä¾†
 */
export type ExtractComponentProps<TComponent> = TComponent extends new () => {
  $props: infer P;
}
  ? P
  : never

/** æå– Vue Component slots */
export type ExtractComponentSlots<TComponent> = TComponent extends new () => {
  $slots: infer P;
}
  ? P
  : never
```

æ¥è‘—å»ºç«‹åŸºæ–¼ Quasar çš„ utils å·¥å…·ã€‚

ä¸»è¦æœ‰ 2 å€‹ functionï¼š

- wrapWithDialogï¼šç”¨æ–¼å°‡æŒ‡å®šå…ƒä»¶ä½¿ç”¨ QDialog åŒ…èµ·ä¾†ã€‚
- openUsingDialogï¼šå°‡ wrapWithDialog åŒ…è£¹å¾Œçš„å…ƒä»¶ï¼Œä½¿ç”¨ Dialog é–‹å•Ÿã€‚

`src/common/utils-quasar.ts`

```ts
import { Dialog, QDialog, QDialogProps } from 'quasar'
import { Component, h } from 'vue'
import { ExtractComponentProps, ExtractComponentSlots } from '../types'

/** å°‡ Vue SFC å…ƒä»¶åŒ…è£…ç‚º QDialogï¼Œå¯ä»¥æ›´ç°¡å–®é…åˆ $q.dialog ä½¿ç”¨
 *
 * @param component Vue SFC å…ƒä»¶
 * @param props SFC å…§æ‰€æœ‰åƒæ•¸ï¼ŒåŒ…å« classã€styleã€event ç­‰ç­‰
 * @param dialogProps QDialog åŸæœ¬åƒæ•¸
 *
 * @example
 * ```typescript
 * const component = wrapWithDialog(EditForm, {
 *   data,
 *   onSubmit() {
 *     dialog.hide();
 *   },
 * });
 *
 * const dialog = $q.dialog({ component });
 * ```
 *
 * @example
 * ```typescript
 * $q.dialog({
 *   component: wrapWithDialog(
 *     BrandLog,
 *     {
 *       data,
 *       class: 'w-full'
 *     },
 *     {
 *       fullHeight: true,
 *     }
 *   ),
 * });
 * ```
 */
export function wrapWithDialog<Comp extends Component>(
  component: Comp,
  props?: ExtractComponentProps<Comp>,
  dialogProps?: QDialogProps,
  slots?: ExtractComponentSlots<Comp>
) {
  return h(QDialog, dialogProps, {
    default: () => h(component, props ?? {}, slots ?? {}),
  })
}

/** ä½¿ç”¨ Quasar Dialog é–‹å•Ÿå…ƒä»¶
 *
 * @param component Vue SFC å…ƒä»¶
 * @param props SFC å…§æ‰€æœ‰åƒæ•¸ï¼ŒåŒ…å« classã€styleã€event ç­‰ç­‰
 * @param slots SFC æ’æ§½
 * @param dialogProps QDialog åŸæœ¬åƒæ•¸
 * @returns
 *
 * @example
 * ```typescript
 * const dialog = openUsingDialog(EditForm, {
 *   data,
 *   onSubmit() {
 *     dialog.hide();
 *   },
 * });
 * ```
 */
export function openUsingDialog<Comp extends Component>(
  component: Comp,
  props?: ExtractComponentProps<Comp>,
  dialogProps?: QDialogProps,
  slots?: ExtractComponentSlots<Comp>
) {
  return Dialog.create({
    component: wrapWithDialog(component, props, dialogProps, slots),
  })
}
```

ç¾åœ¨æˆ‘å€‘å¯ä»¥æŠŠå‰›å‰›çš„ç¨‹å¼ç¢¼ï¼š

```ts
$q.dialog({
  component: h(
    QDialog,
    {},
    { default: () => h(CreateForm) }
  )
})
```

æ”¹å¯«æˆé€™æ¨£ï¼š

```ts
openUsingDialog(CreateForm)
```

æ˜¯ä¸æ˜¯æ•´æ½”å¾ˆå¤šå•Šï¼â™ª( â—œÏ‰â—Ùˆ(Ùˆ

è€Œä¸”å› ç‚ºæœ‰åŠ ä¸Šå‹åˆ¥æ¨å°ï¼Œæ‰€ä»¥ä½¿ç”¨æ™‚æœƒæœ‰å¾ˆå®Œæ•´çš„å‹åˆ¥æç¤ºã€‚

![å‹åˆ¥æç¤º](/vue-h-function-makes-quasar-dialog-easier-to-reuse/type-hints.png)

ç¾åœ¨å¯ä»¥é…åˆå…ƒä»¶äº‹ä»¶æ’°å¯«é‚è¼¯äº†ã€‚( â€¢Ì€ Ï‰ â€¢Ì )âœ§

Vue æœƒè‡ªå‹•å°‡å…ƒä»¶ emit çš„äº‹ä»¶åç¨±åŠ ä¸Š on å‰ç¶´ï¼Œæ‰€ä»¥ï¼š

- update:modelValue æœƒè®Šæˆ onUpdate:modelValue
- cancel æœƒè®Šæˆ onCancel

```ts
function openCreateForm() {
  const dialog = openUsingDialog(CreateForm, {
    'onUpdate:modelValue': function (data) {
      alert(`é€å‡ºè³‡æ–™: ${data.name}`)
      dialog.hide()
    },
    onCancel() {
      dialog.hide()
    }
  })
}
```

ä»¥ä¸Šç”¨æ³•è®“å¤§å®¶åƒè€ƒåƒè€ƒï¼Œå¦‚æœæœ‰å•é¡Œé‚„ä¸åæŒ‡æ•™ï¼Œé±ˆé­šæ„Ÿè¬å¤§å®¶ï¼( Â´ â–½ ` )ï¾‰

æ›´å®Œæ•´çš„ç¯„ä¾‹è«‹è¦‹[ç¯„ä¾‹ç¨‹å¼ç¢¼](https://stackblitz.com/~/github.com/Codfisher/quasar-imperative-dialog?file=src/App.vue)ã€‚

## ç¸½çµ ğŸŸ

- é€é h function ç°¡åŒ– Quasar Dialog çš„ Invoking custom component ç”¨æ³•
- å°‡ h function å°è£ï¼Œæ›´å®¹æ˜“ä½¿ç”¨
